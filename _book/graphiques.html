<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Graphiques | Notes de cours de R - Version 2</title>
  <meta name="description" content="5 Graphiques | Notes de cours de R - Version 2" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Graphiques | Notes de cours de R - Version 2" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="3wen/R_course" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Graphiques | Notes de cours de R - Version 2" />
  
  
  

<meta name="author" content="Ewen Gallic" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="boucles.html"/>
<link rel="next" href="régressions-linéaires.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="styles/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="avant-propos.html"><a href="avant-propos.html"><i class="fa fa-check"></i>Avant Propos</a>
<ul>
<li class="chapter" data-level="0.1" data-path="avant-propos.html"><a href="avant-propos.html#objectifs"><i class="fa fa-check"></i><b>0.1</b> Objectifs</a></li>
<li class="chapter" data-level="0.2" data-path="avant-propos.html"><a href="avant-propos.html#à-qui-sadressent-ces-notes"><i class="fa fa-check"></i><b>0.2</b> À qui s’adressent ces notes ?</a></li>
<li class="chapter" data-level="0.3" data-path="avant-propos.html"><a href="avant-propos.html#remerciements"><i class="fa fa-check"></i><b>0.3</b> Remerciements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#historique"><i class="fa fa-check"></i><b>1.1</b> Historique</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#présentation-de-lespace-de-travail"><i class="fa fa-check"></i><b>1.2</b> Présentation de l’espace de travail</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="introduction.html"><a href="introduction.html#la-console-et-les-fenêtres-de-script"><i class="fa fa-check"></i><b>1.2.1</b> La console et les fenêtres de script</a></li>
<li class="chapter" data-level="1.2.2" data-path="introduction.html"><a href="introduction.html#les-variables"><i class="fa fa-check"></i><b>1.2.2</b> Les variables</a></li>
<li class="chapter" data-level="1.2.3" data-path="introduction.html"><a href="introduction.html#les-packages"><i class="fa fa-check"></i><b>1.2.3</b> Les <em>packages</em></a></li>
<li class="chapter" data-level="1.2.4" data-path="introduction.html"><a href="introduction.html#laide"><i class="fa fa-check"></i><b>1.2.4</b> L’aide</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#un-environnement-de-développement-rstudio"><i class="fa fa-check"></i><b>1.3</b> Un environnement de développement : RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="données.html"><a href="données.html"><i class="fa fa-check"></i><b>2</b> Données</a>
<ul>
<li class="chapter" data-level="2.1" data-path="données.html"><a href="données.html#types-de-données"><i class="fa fa-check"></i><b>2.1</b> Types de données</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="données.html"><a href="données.html#donnees-mode"><i class="fa fa-check"></i><b>2.1.1</b> Mode</a></li>
<li class="chapter" data-level="2.1.2" data-path="données.html"><a href="données.html#longueur"><i class="fa fa-check"></i><b>2.1.2</b> Longueur</a></li>
<li class="chapter" data-level="2.1.3" data-path="données.html"><a href="données.html#lobjet-vide"><i class="fa fa-check"></i><b>2.1.3</b> L’objet vide</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="données.html"><a href="données.html#structures"><i class="fa fa-check"></i><b>2.2</b> Structure des données</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="données.html"><a href="données.html#structures-de-base"><i class="fa fa-check"></i><b>2.2.1</b> Structures de base</a></li>
<li class="chapter" data-level="2.2.2" data-path="données.html"><a href="données.html#tableaux-de-données"><i class="fa fa-check"></i><b>2.2.2</b> Tableaux de données</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="données.html"><a href="données.html#importation-exportation-et-création-de-données"><i class="fa fa-check"></i><b>2.3</b> Importation, exportation et création de données</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="données.html"><a href="données.html#importation"><i class="fa fa-check"></i><b>2.3.1</b> Importation</a></li>
<li class="chapter" data-level="2.3.2" data-path="données.html"><a href="données.html#exportation"><i class="fa fa-check"></i><b>2.3.2</b> Exportation</a></li>
<li class="chapter" data-level="2.3.3" data-path="données.html"><a href="données.html#génération"><i class="fa fa-check"></i><b>2.3.3</b> Génération</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="données.html"><a href="données.html#manipulation-des-données"><i class="fa fa-check"></i><b>2.4</b> Manipulation des données</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="données.html"><a href="données.html#opérateurs"><i class="fa fa-check"></i><b>2.4.1</b> Opérateurs</a></li>
<li class="chapter" data-level="2.4.2" data-path="données.html"><a href="données.html#manip-acces"><i class="fa fa-check"></i><b>2.4.2</b> Accès aux valeurs, modifications</a></li>
<li class="chapter" data-level="2.4.3" data-path="données.html"><a href="données.html#chaînes-de-caractères"><i class="fa fa-check"></i><b>2.4.3</b> Chaînes de caractères</a></li>
<li class="chapter" data-level="2.4.4" data-path="données.html"><a href="données.html#dates-1"><i class="fa fa-check"></i><b>2.4.4</b> Dates</a></li>
<li class="chapter" data-level="2.4.5" data-path="données.html"><a href="données.html#calculs-matriciels"><i class="fa fa-check"></i><b>2.4.5</b> Calculs matriciels</a></li>
<li class="chapter" data-level="2.4.6" data-path="données.html"><a href="données.html#tableaux_de_donnees"><i class="fa fa-check"></i><b>2.4.6</b> Tableaux de données</a></li>
<li class="chapter" data-level="2.4.7" data-path="données.html"><a href="données.html#data-tables"><i class="fa fa-check"></i><b>2.4.7</b> Data tables</a></li>
<li class="chapter" data-level="2.4.8" data-path="données.html"><a href="données.html#quelques-fonctions-utiles"><i class="fa fa-check"></i><b>2.4.8</b> Quelques fonctions utiles</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="données.html"><a href="données.html#exercices"><i class="fa fa-check"></i><b>2.5</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="fonction.html"><a href="fonction.html"><i class="fa fa-check"></i><b>3</b> Fonction</a>
<ul>
<li class="chapter" data-level="3.1" data-path="fonction.html"><a href="fonction.html#définition"><i class="fa fa-check"></i><b>3.1</b> Définition</a></li>
<li class="chapter" data-level="3.2" data-path="fonction.html"><a href="fonction.html#fonctions_structure"><i class="fa fa-check"></i><b>3.2</b> La structure d’une fonction</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="fonction.html"><a href="fonction.html#fonctions_structure_corps"><i class="fa fa-check"></i><b>3.2.1</b> Le corps d’une fonction</a></li>
<li class="chapter" data-level="3.2.2" data-path="fonction.html"><a href="fonction.html#fonctions_structure_parametres"><i class="fa fa-check"></i><b>3.2.2</b> Les arguments d’une fonction</a></li>
<li class="chapter" data-level="3.2.3" data-path="fonction.html"><a href="fonction.html#fonctions_structure_environnement"><i class="fa fa-check"></i><b>3.2.3</b> Portée des fonctions</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="fonction.html"><a href="fonction.html#documentation"><i class="fa fa-check"></i><b>3.3</b> Documentation</a></li>
<li class="chapter" data-level="3.4" data-path="fonction.html"><a href="fonction.html#exercices-1"><i class="fa fa-check"></i><b>3.4</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="boucles.html"><a href="boucles.html"><i class="fa fa-check"></i><b>4</b> Boucles et calculs vectoriels</a>
<ul>
<li class="chapter" data-level="4.1" data-path="boucles.html"><a href="boucles.html#boucles_boucles"><i class="fa fa-check"></i><b>4.1</b> Les boucles</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="boucles.html"><a href="boucles.html#boucles_boucles_while"><i class="fa fa-check"></i><b>4.1.1</b> Les boucles avec <code>while()</code></a></li>
<li class="chapter" data-level="4.1.2" data-path="boucles.html"><a href="boucles.html#boucles_boucles_for"><i class="fa fa-check"></i><b>4.1.2</b> Les boucles avec <code>for()</code></a></li>
<li class="chapter" data-level="4.1.3" data-path="boucles.html"><a href="boucles.html#boucles_boucles_conditions"><i class="fa fa-check"></i><b>4.1.3</b> Les conditions</a></li>
<li class="chapter" data-level="4.1.4" data-path="boucles.html"><a href="boucles.html#boucles_boucles_repeat"><i class="fa fa-check"></i><b>4.1.4</b> L’instruction <code>repeat</code> … <code>break</code></a></li>
<li class="chapter" data-level="4.1.5" data-path="boucles.html"><a href="boucles.html#boucles_boucles_next"><i class="fa fa-check"></i><b>4.1.5</b> L’instruction <code>next</code> … <code>break</code></a></li>
<li class="chapter" data-level="4.1.6" data-path="boucles.html"><a href="boucles.html#boucles_boucles_progressbar"><i class="fa fa-check"></i><b>4.1.6</b> Barre de progression</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="boucles.html"><a href="boucles.html#boucles-vectorisation"><i class="fa fa-check"></i><b>4.2</b> La vectorisation</a></li>
<li class="chapter" data-level="4.3" data-path="boucles.html"><a href="boucles.html#boucles-vectorisation-purrr"><i class="fa fa-check"></i><b>4.3</b> Avec {<code>purrr</code>}</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="boucles.html"><a href="boucles.html#listes-ou-vecteurs-en-input"><i class="fa fa-check"></i><b>4.3.1</b> Listes ou vecteurs en <em>input</em></a></li>
<li class="chapter" data-level="4.3.2" data-path="boucles.html"><a href="boucles.html#tibbles-en-input"><i class="fa fa-check"></i><b>4.3.2</b> Tibbles en <em>input</em></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="boucles.html"><a href="boucles.html#boucles-vectorisation-plyr"><i class="fa fa-check"></i><b>4.4</b> Avec {<code>plyr</code>}</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="boucles.html"><a href="boucles.html#boucles-vectorisation-plyr-a-ply"><i class="fa fa-check"></i><b>4.4.1</b> Array en <em>input</em></a></li>
<li class="chapter" data-level="4.4.2" data-path="boucles.html"><a href="boucles.html#boucles-vectorisation-plyr-d-ply"><i class="fa fa-check"></i><b>4.4.2</b> <em>Data frame</em> en <em>input</em></a></li>
<li class="chapter" data-level="4.4.3" data-path="boucles.html"><a href="boucles.html#boucles-vectorisation_plyr-l-ply"><i class="fa fa-check"></i><b>4.4.3</b> <em>List</em> en <em>input</em></a></li>
<li class="chapter" data-level="4.4.4" data-path="boucles.html"><a href="boucles.html#boucles-vectorisation-plyr-parallel"><i class="fa fa-check"></i><b>4.4.4</b> Calcul parallèle</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="boucles.html"><a href="boucles.html#boucles-vectorisation-apply"><i class="fa fa-check"></i><b>4.5</b> Avec {<code>base</code>}</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="boucles.html"><a href="boucles.html#boucles-vectorisation-apply-lapply"><i class="fa fa-check"></i><b>4.5.1</b> La fonction <code>lapply</code></a></li>
<li class="chapter" data-level="4.5.2" data-path="boucles.html"><a href="boucles.html#boucles-vectorisation-apply-sapply"><i class="fa fa-check"></i><b>4.5.2</b> La fonction <code>sapply()</code></a></li>
<li class="chapter" data-level="4.5.3" data-path="boucles.html"><a href="boucles.html#boucles-vectorisation-apply-vapply"><i class="fa fa-check"></i><b>4.5.3</b> La fonction <code>vapply</code></a></li>
<li class="chapter" data-level="4.5.4" data-path="boucles.html"><a href="boucles.html#boucles-vectorisation-apply-apply"><i class="fa fa-check"></i><b>4.5.4</b> La fonction <code>apply()</code></a></li>
<li class="chapter" data-level="4.5.5" data-path="boucles.html"><a href="boucles.html#boucles_vectorisation_apply_tapply"><i class="fa fa-check"></i><b>4.5.5</b> La fonction <code>tapply()</code></a></li>
<li class="chapter" data-level="4.5.6" data-path="boucles.html"><a href="boucles.html#boucles_vectorisation_apply_mapply"><i class="fa fa-check"></i><b>4.5.6</b> La fonction <code>mapply()</code></a></li>
<li class="chapter" data-level="4.5.7" data-path="boucles.html"><a href="boucles.html#boucles_vectorisation_Vectorize"><i class="fa fa-check"></i><b>4.5.7</b> La fonction <code>Vectorize()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="boucles.html"><a href="boucles.html#boucles_exercices"><i class="fa fa-check"></i><b>4.6</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphiques.html"><a href="graphiques.html"><i class="fa fa-check"></i><b>5</b> Graphiques</a>
<ul>
<li class="chapter" data-level="5.1" data-path="graphiques.html"><a href="graphiques.html#graphiques_structure"><i class="fa fa-check"></i><b>5.1</b> Structure</a></li>
<li class="chapter" data-level="5.2" data-path="graphiques.html"><a href="graphiques.html#graphiques_ggplot"><i class="fa fa-check"></i><b>5.2</b> Des graphiques élaborés avec <code>ggplot()</code></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="graphiques.html"><a href="graphiques.html#graphiques_ggplot_aes"><i class="fa fa-check"></i><b>5.2.1</b> Arguments esthétiques</a></li>
<li class="chapter" data-level="5.2.2" data-path="graphiques.html"><a href="graphiques.html#graphiques_ggplot_geom"><i class="fa fa-check"></i><b>5.2.2</b> Arguments géométriques (fonctions <code>geom_*</code>)</a></li>
<li class="chapter" data-level="5.2.3" data-path="graphiques.html"><a href="graphiques.html#graphiques_ggplot_stat"><i class="fa fa-check"></i><b>5.2.3</b> Arguments statistiques</a></li>
<li class="chapter" data-level="5.2.4" data-path="graphiques.html"><a href="graphiques.html#graphiques_ggplot_scale"><i class="fa fa-check"></i><b>5.2.4</b> Échelles (fonction <code>scale_*()</code>)</a></li>
<li class="chapter" data-level="5.2.5" data-path="graphiques.html"><a href="graphiques.html#graphiques_ggplot_group"><i class="fa fa-check"></i><b>5.2.5</b> Groupes</a></li>
<li class="chapter" data-level="5.2.6" data-path="graphiques.html"><a href="graphiques.html#graphiques_ggplot_annotations"><i class="fa fa-check"></i><b>5.2.6</b> Annotations</a></li>
<li class="chapter" data-level="5.2.7" data-path="graphiques.html"><a href="graphiques.html#graphiques_ggplot_position"><i class="fa fa-check"></i><b>5.2.7</b> Positions</a></li>
<li class="chapter" data-level="5.2.8" data-path="graphiques.html"><a href="graphiques.html#graphiques_ggplot_facet"><i class="fa fa-check"></i><b>5.2.8</b> Facettes</a></li>
<li class="chapter" data-level="5.2.9" data-path="graphiques.html"><a href="graphiques.html#graphiques_ggplot_coord"><i class="fa fa-check"></i><b>5.2.9</b> Coordonnées</a></li>
<li class="chapter" data-level="5.2.10" data-path="graphiques.html"><a href="graphiques.html#graphiques_ggplot_axes"><i class="fa fa-check"></i><b>5.2.10</b> Titres, axes, légendes</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="graphiques.html"><a href="graphiques.html#graphiques_enregistrement"><i class="fa fa-check"></i><b>5.3</b> Enregistrement des graphiques</a></li>
<li class="chapter" data-level="5.4" data-path="graphiques.html"><a href="graphiques.html#graphiques_maps"><i class="fa fa-check"></i><b>5.4</b> Cartes</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="graphiques.html"><a href="graphiques.html#graphiques_maps_recup"><i class="fa fa-check"></i><b>5.4.1</b> Récupérer des cartes toutes faites</a></li>
<li class="chapter" data-level="5.4.2" data-path="graphiques.html"><a href="graphiques.html#graphiques_maps_choroplethe"><i class="fa fa-check"></i><b>5.4.2</b> Carte choroplèthe</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="graphiques.html"><a href="graphiques.html#graphiques_3d"><i class="fa fa-check"></i><b>5.5</b> Graphiques en 3D</a></li>
<li class="chapter" data-level="5.6" data-path="graphiques.html"><a href="graphiques.html#graphiques_exercices"><i class="fa fa-check"></i><b>5.6</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="régressions-linéaires.html"><a href="régressions-linéaires.html"><i class="fa fa-check"></i><b>6</b> Régressions linéaires</a>
<ul>
<li class="chapter" data-level="6.1" data-path="régressions-linéaires.html"><a href="régressions-linéaires.html#rappels"><i class="fa fa-check"></i><b>6.1</b> Rappels</a></li>
<li class="chapter" data-level="6.2" data-path="régressions-linéaires.html"><a href="régressions-linéaires.html#regressions_donnees"><i class="fa fa-check"></i><b>6.2</b> Données de l’exemple</a></li>
<li class="chapter" data-level="6.3" data-path="régressions-linéaires.html"><a href="régressions-linéaires.html#estimation-des-paramètres"><i class="fa fa-check"></i><b>6.3</b> Estimation des paramètres {#}</a></li>
<li class="chapter" data-level="6.4" data-path="régressions-linéaires.html"><a href="régressions-linéaires.html#regressions_lecture"><i class="fa fa-check"></i><b>6.4</b> Lecture des sorties</a></li>
<li class="chapter" data-level="6.5" data-path="régressions-linéaires.html"><a href="régressions-linéaires.html#regressions_extractions"><i class="fa fa-check"></i><b>6.5</b> Extractions</a></li>
<li class="chapter" data-level="6.6" data-path="régressions-linéaires.html"><a href="régressions-linéaires.html#regressions_facteurs"><i class="fa fa-check"></i><b>6.6</b> Variables catégorielles</a></li>
<li class="chapter" data-level="6.7" data-path="régressions-linéaires.html"><a href="régressions-linéaires.html#regressions_tests"><i class="fa fa-check"></i><b>6.7</b> Tests de nullité des coefficients et intervalles de confiance</a></li>
<li class="chapter" data-level="6.8" data-path="régressions-linéaires.html"><a href="régressions-linéaires.html#regressions_previsions"><i class="fa fa-check"></i><b>6.8</b> Prévisions</a></li>
<li class="chapter" data-level="6.9" data-path="régressions-linéaires.html"><a href="régressions-linéaires.html#exercices-sur-la-régression"><i class="fa fa-check"></i><b>6.9</b> Exercices sur la régression</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="regex.html"><a href="regex.html"><i class="fa fa-check"></i><b>7</b> Expressions régulières</a>
<ul>
<li class="chapter" data-level="7.1" data-path="regex.html"><a href="regex.html#manip_regex_structure"><i class="fa fa-check"></i><b>7.1</b> Les recherches basiques</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="regex.html"><a href="regex.html#manip_regex_stringr_detect"><i class="fa fa-check"></i><b>7.1.1</b> Détection d’un motif avec <code>str_detect()</code></a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="regex.html"><a href="regex.html#manip_regex_classes"><i class="fa fa-check"></i><b>7.2</b> Les classes de caractères</a></li>
<li class="chapter" data-level="7.3" data-path="regex.html"><a href="regex.html#manip_regex_quantificateurs"><i class="fa fa-check"></i><b>7.3</b> Les quantificateurs</a></li>
<li class="chapter" data-level="7.4" data-path="regex.html"><a href="regex.html#manip_regex_metacaracteres"><i class="fa fa-check"></i><b>7.4</b> Les métacaractères</a></li>
<li class="chapter" data-level="7.5" data-path="regex.html"><a href="regex.html#manip_regex_stringr"><i class="fa fa-check"></i><b>7.5</b> Quelques fonctions du <em>package</em> {<code>stringr</code>}</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="regex.html"><a href="regex.html#manip_regex_stringr_extract"><i class="fa fa-check"></i><b>7.5.1</b> La fonction <code>str_detect()</code></a></li>
<li class="chapter" data-level="7.5.2" data-path="regex.html"><a href="regex.html#manip_regex_stringr_extract_all"><i class="fa fa-check"></i><b>7.5.2</b> La fonction <code>str_extract_all()</code></a></li>
<li class="chapter" data-level="7.5.3" data-path="regex.html"><a href="regex.html#manip_regex_stringr_match"><i class="fa fa-check"></i><b>7.5.3</b> La fonction <code>str_match()</code></a></li>
<li class="chapter" data-level="7.5.4" data-path="regex.html"><a href="regex.html#manip_regex_stringr_match_all"><i class="fa fa-check"></i><b>7.5.4</b> La fonction <code>str_match_all()</code></a></li>
<li class="chapter" data-level="7.5.5" data-path="regex.html"><a href="regex.html#manip_regex_stringr_locate"><i class="fa fa-check"></i><b>7.5.5</b> La fonction <code>str_locate()</code></a></li>
<li class="chapter" data-level="7.5.6" data-path="regex.html"><a href="regex.html#manip_regex_stringr_locate_all"><i class="fa fa-check"></i><b>7.5.6</b> La fonction <code>str_locate_all()</code></a></li>
<li class="chapter" data-level="7.5.7" data-path="regex.html"><a href="regex.html#manip_regex_stringr_replace"><i class="fa fa-check"></i><b>7.5.7</b> La fonction <code>str_replace()</code></a></li>
<li class="chapter" data-level="7.5.8" data-path="regex.html"><a href="regex.html#manip_regex_stringr_replace_all"><i class="fa fa-check"></i><b>7.5.8</b> La fonction <code>str_replace_all()</code></a></li>
<li class="chapter" data-level="7.5.9" data-path="regex.html"><a href="regex.html#manip_regex_stringr_split"><i class="fa fa-check"></i><b>7.5.9</b> La fonction <code>str_split()</code></a></li>
<li class="chapter" data-level="7.5.10" data-path="regex.html"><a href="regex.html#manip_regex_stringr_split_fixed"><i class="fa fa-check"></i><b>7.5.10</b> La fonction <code>str_string_fixed()</code></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="regex.html"><a href="regex.html#manip_regex_base"><i class="fa fa-check"></i><b>7.6</b> Quelques fonctions du <em>package</em> {<code>base</code>}</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pour-aller-plus-loin.html"><a href="pour-aller-plus-loin.html"><i class="fa fa-check"></i><b>8</b> Pour aller plus loin</a>
<ul>
<li class="chapter" data-level="8.1" data-path="pour-aller-plus-loin.html"><a href="pour-aller-plus-loin.html#travailler-par-projets-avec-rstudio"><i class="fa fa-check"></i><b>8.1</b> Travailler par projets, avec RStudio</a></li>
<li class="chapter" data-level="8.2" data-path="pour-aller-plus-loin.html"><a href="pour-aller-plus-loin.html#r-markdown"><i class="fa fa-check"></i><b>8.2</b> R Markdown</a></li>
<li class="chapter" data-level="8.3" data-path="pour-aller-plus-loin.html"><a href="pour-aller-plus-loin.html#modification-de-plusieurs-colonnes"><i class="fa fa-check"></i><b>8.3</b> Modification de plusieurs colonnes</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="pense-bête.html"><a href="pense-bête.html"><i class="fa fa-check"></i><b>9</b> Pense-bête</a>
<ul>
<li class="chapter" data-level="9.1" data-path="pense-bête.html"><a href="pense-bête.html#installer-un-package-depuis-sa-source"><i class="fa fa-check"></i><b>9.1</b> Installer un <em>package</em> depuis sa source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes de cours de R - Version 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="graphiques" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Graphiques</h1>
<p>L’analyse de données passe souvent par une phase de visualisation. <code>R</code> propose différentes méthodes pour créer des graphiques. Le <em>package</em> {<code>graphics</code>}, qui est installé d’office et chargé par défaut au démarrage de <code>R</code>, contient de nombreuses fonctions pour réaliser des graphiques. Cependant, nous allons plutôt présenter les bases de la confection de graphiques à partir du <em>package</em> {<code>ggplot2</code>}. Comme ce document a vocation à être une introduction, seule une infime partie des possibilités offertes par {<code>ggplot2</code>} est abordée. Le lecteur ou la lectrice intéressé•e est invité•e à consulter des excellents ouvrages ayant été publiés <span class="citation">(Chang <a href="#ref-Chang_2013_R" role="doc-biblioref">2013</a>, Wickham_2009_ggplot2)</span>.</p>
<p>Les graphiques avec {<code>ggplot2</code>} sont crées par couches (<em>layers</em>), avec la première constituée des données brutes, puis les suivantes d’annotations, d’informations statistiques. {<code>ggplot2</code>} s’appuie sur une grammaire. L’apprentissage de cette grammaire nécessite un peu de temps, mais permet de créer des graphiques intelligibles. La grammaire graphique crée une carte, un plan (<em>mapping</em>) pour passer des données aux attributs esthétiques des objets géométriques (comme la couleur, la forme, ou la taille des points, lignes, etc.). Elle permet également d’appliquer des transformations aux données avant de les représenter, ou encore de faire du facettage (<em>faceting</em>).</p>
<p>Pour pouvoir utiliser les fonctions de {<code>ggplot2</code>}, il est nécessaire d’installer le <em>package</em> lors de la première utilisation, puis de le charger les fois suivantes.</p>
<div class="sourceCode" id="cb1107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1107-1"><a href="graphiques.html#cb1107-1" aria-hidden="true"></a><span class="co"># Lors de la première utilisation</span></span>
<span id="cb1107-2"><a href="graphiques.html#cb1107-2" aria-hidden="true"></a><span class="kw">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb1107-3"><a href="graphiques.html#cb1107-3" aria-hidden="true"></a></span>
<span id="cb1107-4"><a href="graphiques.html#cb1107-4" aria-hidden="true"></a><span class="co"># Les fois suivantes</span></span>
<span id="cb1107-5"><a href="graphiques.html#cb1107-5" aria-hidden="true"></a><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1108-1"><a href="graphiques.html#cb1108-1" aria-hidden="true"></a><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span></code></pre></div>
<p>Avant de rentrer dans le vif du sujet, il est important de mentionner la page d’aide du <em>package</em> sur Internet, qui est très bien réalisée, et s’avère être un excellent aide-mémoire : <a href="https://ggplot2.tidyverse.org/reference/" class="uri">https://ggplot2.tidyverse.org/reference/</a>.</p>
<div id="graphiques_structure" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Structure</h2>
<p>Les éléments de la grammaire graphique utilisés par {<code>ggplot2</code>} sont les suivants :</p>
<ul>
<li>des données brutes (<strong><em>data</em></strong>) ;</li>
<li>une projection graphique pour lier ces données aux attributs esthétiques (<strong><em>mapping</em></strong>) ;</li>
<li>des objets géométriques (<strong><em>geom</em></strong>) (points, lignes, polygones, etc.) ;
-des transformations statistiques (<strong><em>stats</em></strong>) ;</li>
<li>des échelles (<strong><em>scale</em></strong>) qui lient les données à un espace esthétique ;</li>
<li>un système de coordonnées (<strong><em>coord</em></strong>), indiquant comment les coordonnées issues des données sont positionnées sur le graphique ;</li>
<li>une indication de regroupement à effectuer dans les données pour créer des sous-groupes, afin de créer des facettes (<strong><em>facet</em></strong>).</li>
</ul>
<p>Les mots en gras dans la liste ci-avant servent de base dans les noms des fonctions du <em>package</em> {<code>ggplot2</code>}. Par exemple, les fonctions pour définir le type de géométrie souhaité commencent par <code>geom_</code>.</p>
<p>La création d’un graphique avec {<code>ggplot2</code>} débute avec l’appel de la fonction <code>ggplot()</code>. Les couches supplémentaires (<em>layers</em>) sont ajoutées en ayant recours au symbole <code>+</code>. La syntaxe est la suivante :</p>
<div class="sourceCode" id="cb1109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1109-1"><a href="graphiques.html#cb1109-1" aria-hidden="true"></a><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span>layers</span></code></pre></div>
<p>Il est possible de stocker un graphique créé avec {<code>ggplot2</code>} dans une variable, en utilisant la flèche d’assignation. Des nouvelles couches peuvent ensuite être ajoutées à l’objet stocké.</p>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1110-1"><a href="graphiques.html#cb1110-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span>layers</span>
<span id="cb1110-2"><a href="graphiques.html#cb1110-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span>new_layers</span></code></pre></div>
<p>Les données doivent être fournies sous forme de <em>tibble</em> ou <em>data.frame</em> à la fonction <code>ggplot()</code>.</p>
</div>
<div id="graphiques_ggplot" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Des graphiques élaborés avec <code>ggplot()</code></h2>
<p>Pour illustrer les différentes notions, un échantillon de 135 films est utilisé. Il est issus de la base <code>film</code> obtenue, à l’époque, sur un site qui s’appelait <em>freebase</em>. Ce jeu de données contient des informations relatives à la date de première date de sortie, à la durée la plus longue du film, l’estimation du budget, les revenus bruts et le premier pays indiqué concernant la réalisation du film.</p>
<div class="sourceCode" id="cb1111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1111-1"><a href="graphiques.html#cb1111-1" aria-hidden="true"></a><span class="kw">load</span>(<span class="kw">url</span>(<span class="st">&quot;http://egallic.fr/R/films.rda&quot;</span>))</span>
<span id="cb1111-2"><a href="graphiques.html#cb1111-2" aria-hidden="true"></a><span class="kw">head</span>(films)</span></code></pre></div>
<pre><code>##                                      name initial_release_date runtime year
## 1                            Galaxy Quest           1999-12-23     102 1999
## 2                Star Trek: First Contact           1996-11-18     111 1996
## 3                            Forrest Gump           1994-06-23     142 1994
## 4 Star Wars Episode I: The Phantom Menace           1999-05-19     136 1999
## 5                                 Titanic           1997-11-01     194 1997
## 6                        Independence Day           1996-06-25     153 1996
##   estimated_budget gross_revenue                  country country_abr
## 1         4.50e+07      90683916 United States of America         USA
## 2         4.50e+07      92001027 United States of America         USA
## 3         5.50e+07     677387716 United States of America         USA
## 4         1.15e+08    1027044330 United States of America         USA
## 5         2.00e+08    2185240703 United States of America         USA
## 6         7.50e+07     817400891 United States of America         USA</code></pre>
<p>Créons une sous-base, qui ne concerne que quelques pays :</p>
<div class="sourceCode" id="cb1113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1113-1"><a href="graphiques.html#cb1113-1" aria-hidden="true"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1113-2"><a href="graphiques.html#cb1113-2" aria-hidden="true"></a>pays_liste &lt;-<span class="st"> </span></span>
<span id="cb1113-3"><a href="graphiques.html#cb1113-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">c</span>(<span class="st">&quot;United States of America&quot;</span>, <span class="st">&quot;New Zealand&quot;</span>,</span>
<span id="cb1113-4"><a href="graphiques.html#cb1113-4" aria-hidden="true"></a>    <span class="st">&quot;United Kingdom&quot;</span>, <span class="st">&quot;Spain&quot;</span>)</span>
<span id="cb1113-5"><a href="graphiques.html#cb1113-5" aria-hidden="true"></a>films_reduit &lt;-<span class="st"> </span></span>
<span id="cb1113-6"><a href="graphiques.html#cb1113-6" aria-hidden="true"></a><span class="st">  </span>films <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1113-7"><a href="graphiques.html#cb1113-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span>pays_liste)</span></code></pre></div>
<p>Le graphique le plus commun est sans doùte le nuage de points (ou <em>scatterplot</em>).</p>
<p>L’exemple suivant trace des un nuage de points représentant le budget estimé de chaque film en fonction des recettes brutes. Nous avons besoin d’utiliser la fonction <code>geom_point()</code>, qui définit le type de géométrie. D’autres types de géométries sont présentés à la Section @ref(graphiques_ggplot_geom).</p>
<div class="sourceCode" id="cb1114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1114-1"><a href="graphiques.html#cb1114-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films, <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget, <span class="dt">y =</span> gross_revenue)) <span class="op">+</span></span>
<span id="cb1114-2"><a href="graphiques.html#cb1114-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_ggplot-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="graphiques_ggplot_aes" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Arguments esthétiques</h3>
<p>Parmi les arguments esthétiques que l’on peut modifier, on retrouve :</p>
<ul>
<li><code>colour</code> : la couleur ;</li>
<li><code>shape</code> : la forme ;</li>
<li><code>size</code> : la taille ;</li>
<li><code>alpha</code> : la transparence ;</li>
<li><code>fill</code> : le remplissage.</li>
</ul>
<p>Dans l’exemple précédent, ces arguments n’ayant pas étés modifiés, ils ont conservé leur valeur par défaut. Pour les modifier, il suffit d’indiquer la valeur voulue à l’intérieur de la fonction <code>ggplot()</code> ou d’une fonction de géométrie.</p>
<p>Par exemple, pour que la couleur des points soit <code>dodger blue</code> et que la transparence soit de <code>0.8</code> :</p>
<div class="sourceCode" id="cb1115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1115-1"><a href="graphiques.html#cb1115-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films,</span>
<span id="cb1115-2"><a href="graphiques.html#cb1115-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget, <span class="dt">y =</span> gross_revenue)) <span class="op">+</span></span>
<span id="cb1115-3"><a href="graphiques.html#cb1115-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;dodger blue&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.8</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_ggplot_col-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Il est également possible de faire dépendre les arguments esthétiques des valeurs prises par les variables du tableau de données. En fonction du mode de la variable utilisée, les effets seront différents. Par exemple, si on décide de faire dépendre la couleur d’une variable continue, une échelle de couleurs sera utilisée ; si la variable est discrète, une palette de couleurs est utilisée. Pour ce faire, il faut indiquer le <em>mapping</em> à l’intérieur de la fonction <code>aes()</code>.</p>
<p>Par exemple, pour faire dépendre la couleur des points de la valeur prise par l’estimation de budget (variable continue) :</p>
<div class="sourceCode" id="cb1116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1116-1"><a href="graphiques.html#cb1116-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1116-2"><a href="graphiques.html#cb1116-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget, <span class="dt">y =</span> gross_revenue)) <span class="op">+</span></span>
<span id="cb1116-3"><a href="graphiques.html#cb1116-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">.8</span>, <span class="kw">aes</span>(<span class="dt">colour =</span> estimated_budget))</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_ggplot_continue-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Et pour faire dépendre la couleur des points du pays d’origine :</p>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1117-1"><a href="graphiques.html#cb1117-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1117-2"><a href="graphiques.html#cb1117-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget, <span class="dt">y =</span> gross_revenue)) <span class="op">+</span></span>
<span id="cb1117-3"><a href="graphiques.html#cb1117-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">.8</span>, <span class="kw">aes</span>(<span class="dt">colour =</span> country))</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_ggplot_continue_2-1.png" width="672" style="display: block; margin: auto;" /></p>

<div class="remarque">
<p>Une petite astuce pour créer un <em>bubble chart</em> consiste à attribuer à l’argument <code>size</code> des valeurs prises par une variable.</p>
</div>
<div class="sourceCode" id="cb1118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1118-1"><a href="graphiques.html#cb1118-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1118-2"><a href="graphiques.html#cb1118-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget, <span class="dt">y =</span> gross_revenue)) <span class="op">+</span></span>
<span id="cb1118-3"><a href="graphiques.html#cb1118-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">.8</span>, <span class="kw">aes</span>(<span class="dt">colour =</span> country, <span class="dt">size =</span> runtime))</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_ggplot_bubble-1.png" width="672" style="display: block; margin: auto;" /></p>

<div class="remarque">
<p>Si on souhaite que la couleur de la forme géométrique soit la même pour toutes les observations, il faut renseigner l’argument <code>color</code> dans la fonction <code>geom_*</code> et non pas <code>ggplot()</code>.</p>
</div>
<div class="sourceCode" id="cb1119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1119-1"><a href="graphiques.html#cb1119-1" aria-hidden="true"></a>p_rem &lt;-<span class="st"> </span></span>
<span id="cb1119-2"><a href="graphiques.html#cb1119-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit, </span>
<span id="cb1119-3"><a href="graphiques.html#cb1119-3" aria-hidden="true"></a>         <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget,</span>
<span id="cb1119-4"><a href="graphiques.html#cb1119-4" aria-hidden="true"></a>             <span class="dt">y =</span> gross_revenue)) <span class="op">+</span></span>
<span id="cb1119-5"><a href="graphiques.html#cb1119-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb1119-6"><a href="graphiques.html#cb1119-6" aria-hidden="true"></a>p_rem</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_structure_geom_point_red-1.png" width="672" style="display: block; margin: auto;" /></p>

<div class="remarque">
<p>Si on fournit un argument esthétique à la fonction <code>aes()</code>, à l’intérieur de la fonction <code>geom_*</code>, une nouvelle variable est créé, qui vaut, pour toutes les observations, la valeur attribuée à l’argument esthétique. De fait, {<code>ggplot2</code>} se charge d’interpréter cela comme une variable de mode facteur, qui ne contient qu’un niveau.</p>
</div>
<div class="sourceCode" id="cb1120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1120-1"><a href="graphiques.html#cb1120-1" aria-hidden="true"></a>p_rem &lt;-<span class="st"> </span></span>
<span id="cb1120-2"><a href="graphiques.html#cb1120-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit, </span>
<span id="cb1120-3"><a href="graphiques.html#cb1120-3" aria-hidden="true"></a>         <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget,</span>
<span id="cb1120-4"><a href="graphiques.html#cb1120-4" aria-hidden="true"></a>             <span class="dt">y =</span> gross_revenue)) <span class="op">+</span></span>
<span id="cb1120-5"><a href="graphiques.html#cb1120-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> <span class="st">&quot;green&quot;</span>))</span>
<span id="cb1120-6"><a href="graphiques.html#cb1120-6" aria-hidden="true"></a><span class="co"># La couleur pour les points va s&#39;appuyer sur une variable qui</span></span>
<span id="cb1120-7"><a href="graphiques.html#cb1120-7" aria-hidden="true"></a><span class="co"># vient d&#39;être créée, et qui vaut &quot;green&quot; pour toutes les obs.</span></span>
<span id="cb1120-8"><a href="graphiques.html#cb1120-8" aria-hidden="true"></a><span class="co"># Il est alors considéré qu&#39;il n&#39;y a qu&#39;un facteur.</span></span>
<span id="cb1120-9"><a href="graphiques.html#cb1120-9" aria-hidden="true"></a><span class="co"># Donc la couleur affichée sera le rose !</span></span>
<span id="cb1120-10"><a href="graphiques.html#cb1120-10" aria-hidden="true"></a>p_rem</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_structure_geom_point_red_2-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_ggplot_geom" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Arguments géométriques (fonctions <code>geom_*</code>)</h3>
<p>Pour définir le type d’objet géométrique utilisé pour représenter les données, on ajoute une couche au graphique. Le nom des fonctions qui ajoutent ce type de couches possède la syntaxe suivante : <code>geom_*</code>, où l’étoile doit être remplacée par le nom d’une forme géométrique. Les principales fonctions sont les suivantes :</p>
<ul>
<li><code>geom_point()</code> : tracer des points ;</li>
<li><code>geom_line()</code> : tracer des lignes ;</li>
<li><code>geom_polygon()</code> : tracer des lignes ;</li>
<li><code>geom_path()</code> : tracer des points dans l’ordre du tableau de données</li>
<li><code>geom_step()</code> : faire un graphique en escalier ;</li>
<li><code>geom_boxplot()</code> : tracer une boîte à moustache ;</li>
<li><code>geom_jitter()</code> : mettre des points côte à côte pour une variable catégorielle ;</li>
<li><code>geom_smooth()</code> : ajouter une courbe de tendance ;</li>
<li><code>geom_histogram()</code> : tracer un histogramme ;</li>
<li><code>geom_bar()</code> : tracer un diagramme en bâton ;</li>
<li><code>geom_density()</code> : tracer une estimation de densité.</li>
</ul>
<p>Toutes les fonctions <code>geom_*</code> possèdent les arguments optionnels suivants : <code>data</code>, <code>mapping</code>, <code>...</code>, <code>geom</code> (ou <code>stat</code>) et <code>position</code>. S’ils sont omis, leur valeur est héritée de celle des arguments correspondants de la fonction <code>ggplot()</code>. Si à l’inverse ils sont renseignés, alors leur valeur vient remplacer celle héritée. Certaines fonctions ont d’autres arguments ; le lecteur ou la lectrice est invité•e à consulter l’aide pour de plus amples détails.</p>
<p>Le but ici n’est pas de passer en revue chaque fonction, mais de permettre au lecteur ou à la lectrice de comprendre le fonctionnement des graphiques en couche avec {<code>ggplot2</code>}. Toutes les fonctions <code>geom_*</code> fonctionnent de la même manière. En étant capable de comprendre les exemples qui suivent, il ne devrait pas être compliqué d’explorer les cas non traités dans ce document.</p>
<div id="graphiques_ggplot_geom_points" class="section level4" number="5.2.2.1">
<h4><span class="header-section-number">5.2.2.1</span> Points</h4>
<p>La fonction qui permet de tracer des points a déjà été utilisées à plusieurs reprises : <code>geom_point()</code>.</p>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1121-1"><a href="graphiques.html#cb1121-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1121-2"><a href="graphiques.html#cb1121-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget,</span>
<span id="cb1121-3"><a href="graphiques.html#cb1121-3" aria-hidden="true"></a>           <span class="dt">y =</span> gross_revenue, <span class="dt">col =</span> country)) <span class="op">+</span></span>
<span id="cb1121-4"><a href="graphiques.html#cb1121-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_point-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Si on renseigne le chemin vers les données à l’intérieur de la fonction <code>geom_point()</code> plutôt que dans <code>ggplot()</code>, il faut veiller à bien préciser l’argument <code>data</code> !</p>
<div class="sourceCode" id="cb1122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1122-1"><a href="graphiques.html#cb1122-1" aria-hidden="true"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1122-2"><a href="graphiques.html#cb1122-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1122-3"><a href="graphiques.html#cb1122-3" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget,</span>
<span id="cb1122-4"><a href="graphiques.html#cb1122-4" aria-hidden="true"></a>           <span class="dt">y =</span> gross_revenue, <span class="dt">col =</span> country))</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_point_2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Attention, pour que tous les points aient la même couleur, il faut que l’argument esthétique soit fourni à <code>geom_point()</code> et non pas à <code>ggplot()</code>.</p>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="graphiques.html#cb1123-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1123-2"><a href="graphiques.html#cb1123-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget, <span class="dt">y =</span> gross_revenue)) <span class="op">+</span></span>
<span id="cb1123-3"><a href="graphiques.html#cb1123-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_point_3-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_ggplot_geom_line" class="section level4" number="5.2.2.2">
<h4><span class="header-section-number">5.2.2.2</span> Lignes</h4>
<p>Pour tracer des lignes entre les points, il faut utiliser la fonction <code>geom_line()</code>.</p>
<div class="sourceCode" id="cb1124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1124-1"><a href="graphiques.html#cb1124-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1124-2"><a href="graphiques.html#cb1124-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget,</span>
<span id="cb1124-3"><a href="graphiques.html#cb1124-3" aria-hidden="true"></a>           <span class="dt">y =</span> gross_revenue, <span class="dt">col =</span> country)) <span class="op">+</span></span>
<span id="cb1124-4"><a href="graphiques.html#cb1124-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_line-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Le fait d’ajouter l’argument <code>colour</code> et de lui donner en valeur une variable de type facteur crée automatiquement des groupes. Les points de chaque groupe seront reliés entre eux.</p>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1125-1"><a href="graphiques.html#cb1125-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1125-2"><a href="graphiques.html#cb1125-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget,</span>
<span id="cb1125-3"><a href="graphiques.html#cb1125-3" aria-hidden="true"></a>           <span class="dt">y =</span> gross_revenue, <span class="dt">group =</span> country)) <span class="op">+</span></span>
<span id="cb1125-4"><a href="graphiques.html#cb1125-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_line_2-1.png" width="672" /></p>
</div>
<div id="graphiques_ggplot_geom_polygon" class="section level4" number="5.2.2.3">
<h4><span class="header-section-number">5.2.2.3</span> Polygones</h4>
<p>La fonction <code>geom_polygon()</code> permet de tracer des polygones. Les coordonnées doivent être ordonnées dans le sens direct. Tandis que de nombreuses fonctions utilisant des polygones en <code>R</code> nécessitent que la première et la dernière observation soient identiques, et ce afin de pouvoir fermer le polygone, ce n’est pas obligatoire avec {<code>ggplot2</code>}.</p>
<div class="sourceCode" id="cb1126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1126-1"><a href="graphiques.html#cb1126-1" aria-hidden="true"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">1</span>, <span class="fl">0.75</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>))</span>
<span id="cb1126-2"><a href="graphiques.html#cb1126-2" aria-hidden="true"></a></span>
<span id="cb1126-3"><a href="graphiques.html#cb1126-3" aria-hidden="true"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1126-4"><a href="graphiques.html#cb1126-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y), <span class="dt">fill =</span> <span class="st">&quot;light green&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_polygon-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_ggplot_geom_boxplot" class="section level4" number="5.2.2.4">
<h4><span class="header-section-number">5.2.2.4</span> Boxplot</h4>
<p>Pour réaliser une boîte à moustache, il faut utiliser la fonction <code>geom_boxplot()</code>.</p>
<div class="sourceCode" id="cb1127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1127-1"><a href="graphiques.html#cb1127-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1127-2"><a href="graphiques.html#cb1127-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> country, <span class="dt">y =</span> runtime, <span class="dt">fill =</span> country)) <span class="op">+</span></span>
<span id="cb1127-3"><a href="graphiques.html#cb1127-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_boxplot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_boxplot-1.png" width="672" style="display: block; margin: auto;" /></p>

<div class="remarque">
<p>La fonction <code>geom_boxplot()</code> ne permet pas de tracer de manière élégante (au sens du code) la boîte à moustache pour une seule variable. Il faut pour cela, avoir recours à une petite astuce : fournir une variable factorielle à une seule modalité à l’esthétique <code>x</code>.</p>
</div>
<div class="sourceCode" id="cb1128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1128-1"><a href="graphiques.html#cb1128-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1128-2"><a href="graphiques.html#cb1128-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="dv">1</span>), <span class="dt">y =</span> runtime)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_boxplot_seule-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_ggplot_geom_jitter" class="section level4" number="5.2.2.5">
<h4><span class="header-section-number">5.2.2.5</span> Gigue</h4>
<p>Une forme géométrique qui peut être pratique est <code>jitter</code>. Elle permet de placer les points côte à côte au lieu de les entasser. Dans le cas de variables catégorielles, cela peut être intéressant à utiliser.</p>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1129-1"><a href="graphiques.html#cb1129-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1129-2"><a href="graphiques.html#cb1129-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> country, <span class="dt">y =</span> estimated_budget, <span class="dt">col =</span> country)) <span class="op">+</span></span>
<span id="cb1129-3"><a href="graphiques.html#cb1129-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_qplot_geom_jitter-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="graphiques.html#cb1130-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1130-2"><a href="graphiques.html#cb1130-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> country, <span class="dt">y =</span> estimated_budget, <span class="dt">col =</span> country)) <span class="op">+</span></span>
<span id="cb1130-3"><a href="graphiques.html#cb1130-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_jitter</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_qplot_geom_jitter-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_ggplot_geom_smooth" class="section level4" number="5.2.2.6">
<h4><span class="header-section-number">5.2.2.6</span> Courbe de tendance</h4>
<p>On peut facilement ajouter une courbe de tendance à un nuage de points, en ajoutant une couche avec la fonction <code>geom_smooth()</code>. Des intervalles de confiance associés aux valeurs obtenues par le lissage sont automatiquement dessinés. Pour les retirer, il faut ajouter <code>se=FALSE</code> à la liste des arguments.</p>
<div class="sourceCode" id="cb1131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1131-1"><a href="graphiques.html#cb1131-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1131-2"><a href="graphiques.html#cb1131-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget, <span class="dt">y =</span> gross_revenue)) <span class="op">+</span></span>
<span id="cb1131-3"><a href="graphiques.html#cb1131-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1131-4"><a href="graphiques.html#cb1131-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/raphiques_ggplot_ggplot_smooth-1.png" width="288" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1132-1"><a href="graphiques.html#cb1132-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1132-2"><a href="graphiques.html#cb1132-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget, <span class="dt">y =</span> gross_revenue)) <span class="op">+</span></span>
<span id="cb1132-3"><a href="graphiques.html#cb1132-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1132-4"><a href="graphiques.html#cb1132-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/raphiques_ggplot_ggplot_smooth-2.png" width="288" style="display: block; margin: auto;" /></p>
<p>L’argument <code>method</code> contrôle le type de lissage. Par défaut, la fonction <code>loess()</code> est appelée pour le réaliser, et l’argument <code>method</code> est fixé à <code>loess</code>. Si on regarde la page d’aide de cette fonction, on voit que cette dernière possède plusieurs arguments modifiables. Comme l’argument <code>...</code> est présent dans la fonction <code>ggplot()</code>, on peut transmettre à la fonction de lissage les arguments que l’on souhaite modifier.</p>
<p>Parmi les autres méthodes qu’il est possible d’utiliser pour le lissage, on retrouve <code>lm</code>, pour un modèle linéaire, <code>rlm</code> (<em>package</em> {<code>MASS</code>}) pour un modèle linéaire robuste, ou encore <code>gam</code> (<em>package</em> {<code>mgcv</code>}) pour un modèle additif généralisé.</p>
<p>Voici un exemple, avec un lissage par régression linéaire, avec un intervalle de confiance pour la prévision à <span class="math inline">\(90\%\)</span> :</p>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="graphiques.html#cb1133-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films, </span>
<span id="cb1133-2"><a href="graphiques.html#cb1133-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget, <span class="dt">y =</span> gross_revenue)) <span class="op">+</span></span>
<span id="cb1133-3"><a href="graphiques.html#cb1133-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1133-4"><a href="graphiques.html#cb1133-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">level =</span> <span class="fl">0.9</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_qplot_smooth_ic-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_qplot_geom_histogram" class="section level4" number="5.2.2.7">
<h4><span class="header-section-number">5.2.2.7</span> Histogramme</h4>
<p>Pour réaliser un histogramme, {<code>ggplot2</code>} propose la fonction <code>geom_histogram()</code>. La fenêtre (<em>bindwidth</em>) par défaut est l’étendue divisée par 30.</p>
<div class="sourceCode" id="cb1134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1134-1"><a href="graphiques.html#cb1134-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1134-2"><a href="graphiques.html#cb1134-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> runtime)) <span class="op">+</span></span>
<span id="cb1134-3"><a href="graphiques.html#cb1134-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">fill =</span> <span class="st">&quot;dodger blue&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_histogram-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Si on ajoute au moins un des arguments esthétiques <code>colour</code> ou <code>fill</code> en fonction d’une variable, les histogrammes feront état des sous-groupes.</p>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1135-1"><a href="graphiques.html#cb1135-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1135-2"><a href="graphiques.html#cb1135-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> (estimated_budget<span class="op">/</span><span class="dv">1000000</span>)<span class="op">/</span>runtime,</span>
<span id="cb1135-3"><a href="graphiques.html#cb1135-3" aria-hidden="true"></a>           <span class="dt">fill =</span> country))<span class="op">+</span></span>
<span id="cb1135-4"><a href="graphiques.html#cb1135-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.1</span>, <span class="dt">colour =</span> <span class="st">&quot;dark grey&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_histogram_fill-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_qplot_geom_densite" class="section level4" number="5.2.2.8">
<h4><span class="header-section-number">5.2.2.8</span> Densité</h4>
<p>Pour afficher des estimations de la densité, il faut utiliser la fonction <code>geom_density()</code>. Le noyau peut être changé <em>via</em> l’argument <code>kernel</code> (c.f. la page d’aide <code>?stat_density</code> pour de plus amples détails).</p>
<div class="sourceCode" id="cb1136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1136-1"><a href="graphiques.html#cb1136-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1136-2"><a href="graphiques.html#cb1136-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> (estimated_budget<span class="op">/</span><span class="dv">1000000</span>)<span class="op">/</span>runtime)) <span class="op">+</span></span>
<span id="cb1136-3"><a href="graphiques.html#cb1136-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_densite-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Si on ajoute au moins un des arguments esthétiques <code>colour</code> ou <code>fill</code> en fonction d’une variable, les densités seront estimées pour chaque sous groupe.</p>
<div class="sourceCode" id="cb1137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1137-1"><a href="graphiques.html#cb1137-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1137-2"><a href="graphiques.html#cb1137-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> (estimated_budget<span class="op">/</span><span class="dv">1000000</span>)<span class="op">/</span>runtime,</span>
<span id="cb1137-3"><a href="graphiques.html#cb1137-3" aria-hidden="true"></a>           <span class="dt">fill =</span> country)) <span class="op">+</span></span>
<span id="cb1137-4"><a href="graphiques.html#cb1137-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.5</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_densite_fill-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="rubans" class="section level4" number="5.2.2.9">
<h4><span class="header-section-number">5.2.2.9</span> Rubans</h4>
<p>L’affichage de rubans autour d’une valeur centrale permet, notamment, de réaliser une représentation graphique d’intervalles de confiance. Il suffit pour cela de faire appel à la fonction <code>geom_ribbon()</code> et de renseigner en plus des arguments <code>x</code> et <code>y</code> qui peuvent être hérités d’une couche précédente, les arguments <code>ymin</code> et <code>ymax</code> qui vont définir les valeurs minimum et maximum pour les ordonnées, respectivement, en chaque point d’abscisse.</p>
<p>Admettons que l’on dispose d’un tableau de données dans lequel, pour chaque unité de temps, on dispose d’une valeur de nombre de passagers estimés, ainsi que les bornes d’un intervalle de confiance données dans les colonnes <code>passenger_low</code> et <code>passenger_high</code>.</p>
<div class="sourceCode" id="cb1138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1138-1"><a href="graphiques.html#cb1138-1" aria-hidden="true"></a>df_passengers &lt;-<span class="st"> </span></span>
<span id="cb1138-2"><a href="graphiques.html#cb1138-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">tibble</span>(</span>
<span id="cb1138-3"><a href="graphiques.html#cb1138-3" aria-hidden="true"></a>  <span class="dt">time =</span> <span class="kw">as.vector</span>(<span class="kw">time</span>(AirPassengers)),</span>
<span id="cb1138-4"><a href="graphiques.html#cb1138-4" aria-hidden="true"></a>  <span class="dt">passenger =</span> <span class="kw">as.vector</span>(AirPassengers)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1138-5"><a href="graphiques.html#cb1138-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb1138-6"><a href="graphiques.html#cb1138-6" aria-hidden="true"></a>    <span class="dt">passenger_low =</span> passenger<span class="dv">-20</span>,</span>
<span id="cb1138-7"><a href="graphiques.html#cb1138-7" aria-hidden="true"></a>    <span class="dt">passenger_high =</span> passenger<span class="op">+</span><span class="dv">20</span></span>
<span id="cb1138-8"><a href="graphiques.html#cb1138-8" aria-hidden="true"></a>  )</span>
<span id="cb1138-9"><a href="graphiques.html#cb1138-9" aria-hidden="true"></a>df_passengers</span></code></pre></div>
<pre><code>## # A tibble: 144 x 4
##     time passenger passenger_low passenger_high
##    &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;
##  1 1949        112            92            132
##  2 1949.       118            98            138
##  3 1949.       132           112            152
##  4 1949.       129           109            149
##  5 1949.       121           101            141
##  6 1949.       135           115            155
##  7 1950.       148           128            168
##  8 1950.       148           128            168
##  9 1950.       136           116            156
## 10 1950.       119            99            139
## # … with 134 more rows</code></pre>
<p>Il faut bien penser à afficher le ruban avant la ligne (sinon cette dernière peut se retrouver cachée par le ruban si l’argument <code>alpha</code> du ruban n’autorise aucune transparence).</p>
<div class="sourceCode" id="cb1140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1140-1"><a href="graphiques.html#cb1140-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df_passengers,</span>
<span id="cb1140-2"><a href="graphiques.html#cb1140-2" aria-hidden="true"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> passenger)) <span class="op">+</span></span>
<span id="cb1140-3"><a href="graphiques.html#cb1140-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> passenger_low, <span class="dt">ymax =</span> passenger_high),</span>
<span id="cb1140-4"><a href="graphiques.html#cb1140-4" aria-hidden="true"></a>              <span class="dt">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="op">+</span></span>
<span id="cb1140-5"><a href="graphiques.html#cb1140-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_geom_ribbon-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="graphiques_ggplot_stat" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Arguments statistiques</h3>
<p>Pour effectuer des opérations statistiques sur les données avant de les représenter, {<code>ggplot2</code>} propose de nombreuses fonctions. Leur nom suit la syntaxe suivante : <code>stat_*</code> avec <code>*</code> le nom d’une opération à réaliser, comme par exemple <code>density</code> pour une estimation de la densité par la méthode du noyau. Les fonctions de type <code>geom_*</code> s’appuient sur celles de type <code>stat_*</code>. Une ou plusieurs variables sont créés automatiquement lors de l’appel à ces fonctions.</p>
<p>Il faut savoir qu’il est possible d’accéder à ces variables, à condition de connaître leur nom, en les entourant par deux points de chaque côté. Par exemple, lorsque l’on fait appel à la fonction <code>geom_histogram()</code>, un appel interne à la fonction <code>stat_bin()</code> est fait par défaut (voir le fichier d’aide de la fonction <code>geom_histogram()</code>). Or, la fonction <code>stat_bin()</code> retourne entre autre les variables <code>count</code>, qui indique le nombre d’observations dans chaque classe créée (<em>bin</em>) ; <code>density</code> pour la densité des points dans chaque classe, mise à l’échelle pour que l’intégrale vaille 1 (pourcentage du total sur la largeur de la barre).</p>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1141-1"><a href="graphiques.html#cb1141-1" aria-hidden="true"></a><span class="co"># Par défaut, stat_bin() utilise ..count.. en ordonnées</span></span>
<span id="cb1141-2"><a href="graphiques.html#cb1141-2" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit, <span class="kw">aes</span>(<span class="dt">x =</span> runtime)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_stat-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1142-1"><a href="graphiques.html#cb1142-1" aria-hidden="true"></a><span class="co"># Produit le même résultat</span></span>
<span id="cb1142-2"><a href="graphiques.html#cb1142-2" aria-hidden="true"></a><span class="co"># ggplot(data = films_reduit, aes(x = runtime)) + stat_bin()</span></span>
<span id="cb1142-3"><a href="graphiques.html#cb1142-3" aria-hidden="true"></a></span>
<span id="cb1142-4"><a href="graphiques.html#cb1142-4" aria-hidden="true"></a><span class="co"># Pour afficher la densité estimée à la place</span></span>
<span id="cb1142-5"><a href="graphiques.html#cb1142-5" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit, <span class="kw">aes</span>(<span class="dt">x =</span> runtime)) <span class="op">+</span></span>
<span id="cb1142-6"><a href="graphiques.html#cb1142-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..density..))</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_stat-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>Il n’est pas rare de vouloir tracer un histogramme et d’y ajouter une courbe de densité. Pour cela, avec {<code>ggplot2</code>}, on peut faire appel à la fonction <code>stat_density()</code>, soit directement, soit par l’intermédiaire de la fonction <code>geom_line()</code>, en fournissant la valeur <code>"density"</code> à l’argument <code>stat</code>.</p>
<div class="sourceCode" id="cb1143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1143-1"><a href="graphiques.html#cb1143-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit, <span class="kw">aes</span>(<span class="dt">x =</span> runtime))</span>
<span id="cb1143-2"><a href="graphiques.html#cb1143-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1143-3"><a href="graphiques.html#cb1143-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">stat=</span><span class="st">&quot;density&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_stat_density-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>On peut voir sur le précédent graphique que les valeurs pour l’axe des ordonnées sont basées sur ce qu’utilise par défaut la fonction <code>geom_histogram()</code>[^On peut noter que si on fait appel à la fonction <code>geom_line()</code> avant <code>geom_histogram()</code>, l’étiquette de l’axe des ordonnées sera <code>density</code>, mais les valeurs seront bien celles du nombre de données par classe !], à savoir le nombre de données par classe. En revanche, l’axe des ordonnées pour la densité estimée par <code>stat_density()</code> est la valeur de la densité. Comme les valeurs de la densité sont moins élevées que celles du nombre de points par classe, on n’aperçoit qu’une forme applatie de cette première. Aussi, il faut indiquer à la fonction <code>ggplot()</code> le <em>mapping</em> suivant : <code>y = ..density..</code>. De fait, lors de l’appel de la fonction <code>stat_bin()</code>, la valeur utilisée pour <code>y</code> sera la densité plutôt que la variable de comptage.</p>
<div class="sourceCode" id="cb1144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1144-1"><a href="graphiques.html#cb1144-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit, <span class="kw">aes</span>(<span class="dt">x =</span> runtime, <span class="dt">y =</span> ..density..))</span>
<span id="cb1144-2"><a href="graphiques.html#cb1144-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb1144-3"><a href="graphiques.html#cb1144-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">stat=</span><span class="st">&quot;density&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>)  </span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_stat_2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Un dernier exemple des fonctions <code>stat_*()</code> (le lecteur ou la lectrice étant invité•e à consulter les références mentionnées au sujet de {<code>ggplot2</code>} pour plus de détails sur ces fonctions) : les estimations de densité en 2d.</p>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1145-1"><a href="graphiques.html#cb1145-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit, <span class="kw">aes</span>(<span class="dt">x =</span> runtime, <span class="dt">y =</span> gross_revenue))</span>
<span id="cb1145-2"><a href="graphiques.html#cb1145-2" aria-hidden="true"></a></span>
<span id="cb1145-3"><a href="graphiques.html#cb1145-3" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">stat_density2d</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_stat_3-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1146-1"><a href="graphiques.html#cb1146-1" aria-hidden="true"></a><span class="co"># En faisant dépendre la couleur des lignes de contour de la hauteur</span></span>
<span id="cb1146-2"><a href="graphiques.html#cb1146-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">stat_density2d</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> ..level..)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_stat_3-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>Les principales fonctions <code>stat_*()</code>, qui peuvent donc être soit appelées directement, soit en fournissant le suffixe à l’argument <code>stat</code> d’une fonction <code>geom_*</code>, sont les suivantes :</p>
<ul>
<li><code>stat_bin()</code> : répartition des données en classes ;</li>
<li><code>stat_contour()</code> : calculer les contours des données en 3d ;</li>
<li><code>stat_density()</code> : estimation de densité 1d par la méthode du noyau;</li>
<li><code>stat_density2d()</code> : estimation de densité 2d ;</li>
<li><code>stat_identity()</code> : ne transforme pas les données ;</li>
<li><code>stat_qq()</code> : <em>qqplot</em> (droite de Henry) ;</li>
<li><code>stat_quantile()</code> : quantiles continus ;</li>
<li><code>stat_smooth()</code> : lissage ;</li>
<li><code>stat_sum()</code> : somme les valeurs uniques ;</li>
<li><code>stat_summary()</code> : appliquer une fonction pour faire des <em>summaries</em> sur les valeurs de <code>y</code> ;</li>
<li><code>stat_unique()</code> : retire les valeurs dupliquées.</li>
</ul>
</div>
<div id="graphiques_ggplot_scale" class="section level3" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Échelles (fonction <code>scale_*()</code>)</h3>
<p>Les fonctions <code>scale_*()</code> du <em>package</em> {<code>ggplot2</code>} permettent de définir et contrôler le <em>mapping</em> entre les données et les attributs esthétiques. Chaque argument esthétique possède son échelle, et sa fonction <code>scale_*()</code>. Encore une fois, le nom des fonctions est bien pensé, et tout est uniformisé. De fait, l’utilisateur•trice peut, une fois qu’il/elle a compris le fonctionnement d’une fonction, utiliser toutes les autres aisément.</p>
<p>On peut diviser en quatre catégories les échelles :</p>
<ul>
<li>de positions ;</li>
<li>de couleurs ;</li>
<li>manuelles discrètes ;</li>
<li><code>identity</code> : pas de mise à l’échelle.</li>
</ul>
<p>Ces échelles font donc le lien entre :</p>
<ul>
<li>le domaine (<em>domain</em>) : il s’agit de l’espace des données. Cet espace est caractérisé de manière différente selon la nature des données. En effet, si ces dernières sont discrètes, ce qui est le cas pour les facteurs, les logiques ou encore les chaînes de caractères, alors le domaine sera une énumération des valeurs possibles. En revanche, si les données sont continues, le domaine sera être défini par un intervalle ;</li>
<li>la gamme (<em>range</em>) : il s’agit de l’espace des esthétiques. La gamme sera discrète lorsque le domaine l’est, et sera constituée des valeurs esthétiques correspondantes aux valeurs des données d’<em>input</em>. En revanche, lorsque le domaine est continue, la gamme est alors un chemin, pour indiquer comment passer d’une valeur à une autre.</li>
</ul>
<p>Les échelles sont ajoutées automatiquement aux graphiques et l’utilisateur•trice n’a rien à faire (c’est ce qui a été fait dans les sections précédentes). Cependant, la possibilité de changer ces échelles est offerte à l’utilisateur•trice, par l’intermédiaire des fonction <code>scale_*()</code>. Les échelles dépendent du type de variable en <em>input</em>, à savoir continues (<em>numeric</em>) ou discrètes (<em>factor</em>, <em>character</em> ou <em>logical</em>). Pour ajouter ou modifier une échelle, il faut en construire une nouvelle, et l’ajouter au graphique, à l’aide, encore une fois, de l’opérateur <code>+</code>. Le nom des échelles est composé de deux ou trois parties : le préfixe <code>scale_</code>, puis le nom de l’esthétique auquel on ajoute un trait de soulignement, et enfin le nom de l’échelle à utiliser. Par exemple, pour modifier l’échelle qui gère la couleur, pour des données d’<code>input</code> continues, pour changer les couleurs du gradient, il faut utiliser la fonction <code>scale_colour_gradient()</code>.</p>
<div class="sourceCode" id="cb1147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1147-1"><a href="graphiques.html#cb1147-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1147-2"><a href="graphiques.html#cb1147-2" aria-hidden="true"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget,</span>
<span id="cb1147-3"><a href="graphiques.html#cb1147-3" aria-hidden="true"></a>                <span class="dt">y =</span> gross_revenue, <span class="dt">colour =</span> runtime)) <span class="op">+</span></span>
<span id="cb1147-4"><a href="graphiques.html#cb1147-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb1147-5"><a href="graphiques.html#cb1147-5" aria-hidden="true"></a>p</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_scale-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1148-1"><a href="graphiques.html#cb1148-1" aria-hidden="true"></a><span class="co"># Changer l&#39;échelle des couleurs pour que les films les plus courts</span></span>
<span id="cb1148-2"><a href="graphiques.html#cb1148-2" aria-hidden="true"></a><span class="co"># soient en rouge (#FF0000), et les plus longs en jaune (#FFFF00),</span></span>
<span id="cb1148-3"><a href="graphiques.html#cb1148-3" aria-hidden="true"></a><span class="co"># en créant un dégradé.</span></span>
<span id="cb1148-4"><a href="graphiques.html#cb1148-4" aria-hidden="true"></a><span class="co"># On change également le titre de la légende</span></span>
<span id="cb1148-5"><a href="graphiques.html#cb1148-5" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_colour_gradient</span>(<span class="dt">name =</span> <span class="st">&quot;Runtime&quot;</span>, <span class="dt">low =</span> <span class="st">&quot;#FF0000&quot;</span>, <span class="dt">high =</span><span class="st">&quot;#FFFF00&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_scale-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>Le tableau ci-dessous répertorie les fonctions <code>scale_*()</code> en fonction du type d’esthétique et de la nature discrète ou continue des données.</p>
<table>
<colgroup>
<col width="24%" />
<col width="38%" />
<col width="38%" />
</colgroup>
<thead>
<tr class="header">
<th>Esthétique</th>
<th>Variable discrète</th>
<th>Variable continue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Transparence (alpha)</td>
<td><code>scale_alpha_discrete()</code></td>
<td><code>scale_alpha_continuous()</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>scale_alpha_manual()</code></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td><code>scale_alpha_identity()</code></td>
<td><code>scale_alpha_identity()</code></td>
</tr>
<tr class="even">
<td>Couleur (colour)</td>
<td><code>scale_colour_discrete()</code></td>
<td><code>scale_colour_continuous()</code></td>
</tr>
<tr class="odd">
<td></td>
<td><code>scale_colour_brewer()</code></td>
<td><code>scale_colour_dilstiller()</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>scale_colour_grey()</code></td>
<td><code>scale_colour_gradient()</code></td>
</tr>
<tr class="odd">
<td></td>
<td><code>scale_colour_hue()</code></td>
<td><code>scale_colour_gradient2()</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>scale_colour_manual()</code></td>
<td><code>scale_colour_gradientn()</code></td>
</tr>
<tr class="odd">
<td></td>
<td><code>scale_colour_identity()</code></td>
<td><code>scale_colour_identity()</code></td>
</tr>
<tr class="even">
<td>Remplissage (fill)</td>
<td><code>scale_fill_discrete()</code></td>
<td><code>scale_fill_continuous()</code></td>
</tr>
<tr class="odd">
<td></td>
<td><code>scale_fill_brewer()</code></td>
<td><code>scale_fill_distiller()</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>scale_fill_grey()</code></td>
<td><code>scale_fill_gradient()</code></td>
</tr>
<tr class="odd">
<td></td>
<td><code>scale_fill_hue()</code></td>
<td><code>scale_fill_gradient2()</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>scale_fill_manual()</code></td>
<td><code>scale_fill_gradientn()</code></td>
</tr>
<tr class="odd">
<td></td>
<td><code>scale_fill_identity()</code></td>
<td><code>scale_fill_identity()</code></td>
</tr>
<tr class="even">
<td>Type de ligne (linetype)</td>
<td><code>scale_linetype_discrete()</code></td>
<td><code>scale_linetype_continuous()</code></td>
</tr>
<tr class="odd">
<td></td>
<td><code>scale_linetype_manual()</code></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td><code>scale_linetype_identity()</code></td>
<td><code>scale_linetype_identity()</code></td>
</tr>
<tr class="odd">
<td>Forme</td>
<td><code>scale_shape_discrete()</code></td>
<td><code>scale_shape_continuous()</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>scale_shape_manual()</code></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td><code>scale_shape_identity()</code></td>
<td><code>scale_shape_identity()</code></td>
</tr>
<tr class="even">
<td>Taille (size)</td>
<td><code>scale_size_discrete()</code></td>
<td><code>scale_size_continuous()</code></td>
</tr>
<tr class="odd">
<td></td>
<td><code>scale_size_manual()</code></td>
<td><code>scale_size_area()</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>scale_size_identity()</code></td>
<td><code>scale_size_identity()</code></td>
</tr>
<tr class="odd">
<td>Position (x, y)</td>
<td><code>scale_x_discrete()</code></td>
<td><code>scale_x_continuous()</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>scale_y_discrete()</code></td>
<td><code>scale_y_continuous()</code></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>scale_x_date()</code></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>scale_y_date()</code></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>scale_x_datetime()</code></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>scale_y_datetime()</code></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>scale_x_log10()</code></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>scale_y_log10()</code></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>scale_x_reverse()</code></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>scale_y_reverse()</code></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><code>scale_x_sqrt()</code></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><code>scale_y_sqrt()</code></td>
</tr>
</tbody>
</table>
<p>L’emploi de ces fonctions est simple, et les fichiers d’aide lèvent les éventuels doutes. Prenons cependent le temps de regarder un second exemple. Traçons un nuage de points représentant le revenu brut des films en fonction de leur budget ; faisons dépendre la couleur et la taille des points du pays d’origine, et de la longueur du film respectivement. La couleur dépend donc d’une variable discrète, et la taille d’une variable continue.</p>
<div class="sourceCode" id="cb1149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1149-1"><a href="graphiques.html#cb1149-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1149-2"><a href="graphiques.html#cb1149-2" aria-hidden="true"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget,</span>
<span id="cb1149-3"><a href="graphiques.html#cb1149-3" aria-hidden="true"></a>                <span class="dt">y =</span> gross_revenue,</span>
<span id="cb1149-4"><a href="graphiques.html#cb1149-4" aria-hidden="true"></a>                <span class="dt">colour =</span> country,</span>
<span id="cb1149-5"><a href="graphiques.html#cb1149-5" aria-hidden="true"></a>                <span class="dt">size =</span> runtime)) <span class="op">+</span></span>
<span id="cb1149-6"><a href="graphiques.html#cb1149-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb1149-7"><a href="graphiques.html#cb1149-7" aria-hidden="true"></a></span>
<span id="cb1149-8"><a href="graphiques.html#cb1149-8" aria-hidden="true"></a><span class="co"># Le graphique par défaut</span></span>
<span id="cb1149-9"><a href="graphiques.html#cb1149-9" aria-hidden="true"></a>p</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_scale_2-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1150-1"><a href="graphiques.html#cb1150-1" aria-hidden="true"></a><span class="co"># Dégradé de gris pour la couleur, les valeurs manquantes en orange</span></span>
<span id="cb1150-2"><a href="graphiques.html#cb1150-2" aria-hidden="true"></a><span class="co"># Le titre de la légende est aussi modifié</span></span>
<span id="cb1150-3"><a href="graphiques.html#cb1150-3" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_colour_grey</span>(<span class="dt">name =</span> <span class="st">&quot;Country&quot;</span>, <span class="dt">start =</span> <span class="fl">.1</span>, <span class="dt">end =</span> <span class="fl">.8</span>,</span>
<span id="cb1150-4"><a href="graphiques.html#cb1150-4" aria-hidden="true"></a>                      <span class="dt">na.value =</span> <span class="st">&quot;orange&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_scale_2-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1151-1"><a href="graphiques.html#cb1151-1" aria-hidden="true"></a><span class="co"># Définissons nous-même la couleur pour chaque pays</span></span>
<span id="cb1151-2"><a href="graphiques.html#cb1151-2" aria-hidden="true"></a><span class="co"># Si on souhaite en plus afficher un nom différent,</span></span>
<span id="cb1151-3"><a href="graphiques.html#cb1151-3" aria-hidden="true"></a><span class="co"># il faut faire attention à bien effectuer le matching...</span></span>
<span id="cb1151-4"><a href="graphiques.html#cb1151-4" aria-hidden="true"></a><span class="co"># La variable &quot;country&quot; est transformée en facteur,</span></span>
<span id="cb1151-5"><a href="graphiques.html#cb1151-5" aria-hidden="true"></a><span class="co"># l&#39;ordre est alphabétique (mais peut être changé avec la fonction order())</span></span>
<span id="cb1151-6"><a href="graphiques.html#cb1151-6" aria-hidden="true"></a><span class="kw">levels</span>(<span class="kw">factor</span>(films_reduit<span class="op">$</span>country))</span></code></pre></div>
<pre><code>## [1] &quot;New Zealand&quot;              &quot;Spain&quot;                   
## [3] &quot;United Kingdom&quot;           &quot;United States of America&quot;</code></pre>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1153-1"><a href="graphiques.html#cb1153-1" aria-hidden="true"></a><span class="co"># Une première solution</span></span>
<span id="cb1153-2"><a href="graphiques.html#cb1153-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_colour_manual</span>(<span class="dt">name =</span> <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb1153-3"><a href="graphiques.html#cb1153-3" aria-hidden="true"></a>                        <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;orange&quot;</span>),</span>
<span id="cb1153-4"><a href="graphiques.html#cb1153-4" aria-hidden="true"></a>                        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;NZ&quot;</span>, <span class="st">&quot;ES&quot;</span>, <span class="st">&quot;UK&quot;</span>, <span class="st">&quot;USA&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_scale_2-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1154-1"><a href="graphiques.html#cb1154-1" aria-hidden="true"></a><span class="co"># Une seconde solution, plus longue, moins esthétique, mais plus sûre</span></span>
<span id="cb1154-2"><a href="graphiques.html#cb1154-2" aria-hidden="true"></a>p &lt;-<span class="st"> </span></span>
<span id="cb1154-3"><a href="graphiques.html#cb1154-3" aria-hidden="true"></a><span class="st">  </span>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_colour_manual</span>(<span class="dt">name =</span> <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb1154-4"><a href="graphiques.html#cb1154-4" aria-hidden="true"></a>                          <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;Spain&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;New Zealand&quot;</span> =<span class="st"> &quot;red&quot;</span>,</span>
<span id="cb1154-5"><a href="graphiques.html#cb1154-5" aria-hidden="true"></a>                                     <span class="st">&quot;United States of America&quot;</span> =<span class="st"> &quot;orange&quot;</span>,</span>
<span id="cb1154-6"><a href="graphiques.html#cb1154-6" aria-hidden="true"></a>                                     <span class="st">&quot;United Kingdom&quot;</span> =<span class="st"> &quot;blue&quot;</span>),</span>
<span id="cb1154-7"><a href="graphiques.html#cb1154-7" aria-hidden="true"></a>                          <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Spain&quot;</span> =<span class="st"> &quot;ES&quot;</span>, <span class="st">&quot;New Zealand&quot;</span> =<span class="st"> &quot;NZ&quot;</span>,</span>
<span id="cb1154-8"><a href="graphiques.html#cb1154-8" aria-hidden="true"></a>                                     <span class="st">&quot;United States of America&quot;</span> =<span class="st"> &quot;USA&quot;</span>,</span>
<span id="cb1154-9"><a href="graphiques.html#cb1154-9" aria-hidden="true"></a>                                     <span class="st">&quot;United Kingdom&quot;</span> =<span class="st"> &quot;UK&quot;</span>))</span>
<span id="cb1154-10"><a href="graphiques.html#cb1154-10" aria-hidden="true"></a></span>
<span id="cb1154-11"><a href="graphiques.html#cb1154-11" aria-hidden="true"></a></span>
<span id="cb1154-12"><a href="graphiques.html#cb1154-12" aria-hidden="true"></a><span class="co"># Changeons également la taille</span></span>
<span id="cb1154-13"><a href="graphiques.html#cb1154-13" aria-hidden="true"></a><span class="co"># En choisissant nous même les seuils</span></span>
<span id="cb1154-14"><a href="graphiques.html#cb1154-14" aria-hidden="true"></a><span class="kw">range</span>(films_reduit<span class="op">$</span>runtime)</span></code></pre></div>
<pre><code>## [1]  66 375</code></pre>
<div class="sourceCode" id="cb1156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1156-1"><a href="graphiques.html#cb1156-1" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_size_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Film</span><span class="ch">\n</span><span class="st">Duration&quot;</span>,</span>
<span id="cb1156-2"><a href="graphiques.html#cb1156-2" aria-hidden="true"></a>                          <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">300</span>, <span class="ot">Inf</span>),</span>
<span id="cb1156-3"><a href="graphiques.html#cb1156-3" aria-hidden="true"></a>                          <span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">10</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_scale_2-4.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1157-1"><a href="graphiques.html#cb1157-1" aria-hidden="true"></a><span class="co"># Un autre graphique, avec des dates en abscisses.</span></span>
<span id="cb1157-2"><a href="graphiques.html#cb1157-2" aria-hidden="true"></a><span class="co"># Le package scales offre de merveilleuses fonctions !</span></span>
<span id="cb1157-3"><a href="graphiques.html#cb1157-3" aria-hidden="true"></a>films_reduit<span class="op">$</span>initial_release_date2 &lt;-<span class="st"> </span><span class="kw">as.Date</span>(films_reduit<span class="op">$</span>initial_release_date)</span>
<span id="cb1157-4"><a href="graphiques.html#cb1157-4" aria-hidden="true"></a>p_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1157-5"><a href="graphiques.html#cb1157-5" aria-hidden="true"></a>              <span class="kw">aes</span>(<span class="dt">x =</span> initial_release_date2, <span class="dt">y =</span> runtime)) <span class="op">+</span></span>
<span id="cb1157-6"><a href="graphiques.html#cb1157-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb1157-7"><a href="graphiques.html#cb1157-7" aria-hidden="true"></a></span>
<span id="cb1157-8"><a href="graphiques.html#cb1157-8" aria-hidden="true"></a><span class="co"># En affichant les dates tous les dix ans uniquement</span></span>
<span id="cb1157-9"><a href="graphiques.html#cb1157-9" aria-hidden="true"></a><span class="kw">library</span>(scales)</span>
<span id="cb1157-10"><a href="graphiques.html#cb1157-10" aria-hidden="true"></a>p_<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_date</span>(<span class="dt">breaks =</span> <span class="kw">date_breaks</span>(<span class="st">&quot;10 year&quot;</span>),</span>
<span id="cb1157-11"><a href="graphiques.html#cb1157-11" aria-hidden="true"></a>                   <span class="dt">labels =</span> <span class="kw">date_format</span>(<span class="st">&quot;%Y&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_scale_2-5.png" width="672" style="display: block; margin: auto;" /></p>
<p>Les légendes affichées sont fonction du <em>mapping</em> réalisé, et {<code>ggplot2</code>} essaie de combiner les légendes autant que possible. Par exemple, si le paramétrage de la couleur et de la forme concernent la même variable, au lieu d’afficher deux légendes distinctes (une pour la couleur, et une pour la forme), une seule combinant les deux arguments esthétiques sera affichée. Par ailleurs, il est nécessaire que les légendes qui sont combinées possèdent le même nom. Il est important d’avoir conscience de cela : en effet, pour changer le titre d’une légende, si elle est le résultat d’une combinaison, il est nécessaire de le changer pour toutes les légendes qui composent la combinaison.</p>
<div class="sourceCode" id="cb1158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1158-1"><a href="graphiques.html#cb1158-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1158-2"><a href="graphiques.html#cb1158-2" aria-hidden="true"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget, <span class="dt">y =</span> gross_revenue,</span>
<span id="cb1158-3"><a href="graphiques.html#cb1158-3" aria-hidden="true"></a>                <span class="dt">colour =</span> country_abr, <span class="dt">size =</span> country_abr)) <span class="op">+</span></span>
<span id="cb1158-4"><a href="graphiques.html#cb1158-4" aria-hidden="true"></a><span class="st">              </span><span class="kw">geom_point</span>()</span>
<span id="cb1158-5"><a href="graphiques.html#cb1158-5" aria-hidden="true"></a></span>
<span id="cb1158-6"><a href="graphiques.html#cb1158-6" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_colour_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Country&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_scale_3-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1159-1"><a href="graphiques.html#cb1159-1" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_colour_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Country&quot;</span>) <span class="op">+</span></span>
<span id="cb1159-2"><a href="graphiques.html#cb1159-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_size_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Country&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_scale_3-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_ggplot_group" class="section level3" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> Groupes</h3>
<p>Dans de nombreux cas, {<code>ggplot2</code>} effectue des regroupements automatiquement, lorsqu’il y a besoin de tracer des objets géométriques. Par exemple, lorsque l’on souhaite tracer des points, chaque groupe est constitué d’un seul point. Pour tracer des polygones, chaque groupe est constitué de plusieurs points qu’il faut relier. Le groupement s’effectue en fonction des interactions de toutes les variables qualitatives d’un graphique. Parfois, il est nécessaire de définir à nouveau les groupes (par exemple, si aucune variable discrète n’est appelée dans le graphique). Pour ce faire, il faut préciser quelle variable doit permettre le regroupement, en l’indiquant à l’argument <code>group</code>. L’exemple qui suit s’appuie sur les données <code>AirPassengers</code>, qui renseignent le nombre de passagers aériens annuels entre 1949 et 1960. Si on désire afficher le nombre de passagers en fonction des mois de l’année, en superposant les courbes par année, l’argument <code>group</code> nous le permet.</p>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1160-1"><a href="graphiques.html#cb1160-1" aria-hidden="true"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">year =</span> <span class="kw">rep</span>(<span class="dv">1949</span><span class="op">:</span><span class="dv">1960</span>, <span class="dt">each =</span> <span class="dv">12</span>),</span>
<span id="cb1160-2"><a href="graphiques.html#cb1160-2" aria-hidden="true"></a>           <span class="dt">month =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dv">12</span>),</span>
<span id="cb1160-3"><a href="graphiques.html#cb1160-3" aria-hidden="true"></a>           <span class="dt">passengers =</span> <span class="kw">c</span>(AirPassengers))</span>
<span id="cb1160-4"><a href="graphiques.html#cb1160-4" aria-hidden="true"></a><span class="kw">head</span>(df)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##    year month passengers
##   &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;
## 1  1949     1        112
## 2  1949     2        118
## 3  1949     3        132
## 4  1949     4        129
## 5  1949     5        121
## 6  1949     6        135</code></pre>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1162-1"><a href="graphiques.html#cb1162-1" aria-hidden="true"></a><span class="co"># Sans préciser de groupe</span></span>
<span id="cb1162-2"><a href="graphiques.html#cb1162-2" aria-hidden="true"></a><span class="co"># Comme il n&#39;y a pas de variable discrète, on obtient </span></span>
<span id="cb1162-3"><a href="graphiques.html#cb1162-3" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> month, <span class="dt">y =</span> passengers)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span>
<span id="cb1162-4"><a href="graphiques.html#cb1162-4" aria-hidden="true"></a></span>
<span id="cb1162-5"><a href="graphiques.html#cb1162-5" aria-hidden="true"></a><span class="co"># En précisant que l&#39;on souhaite regrouper par années</span></span>
<span id="cb1162-6"><a href="graphiques.html#cb1162-6" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> month, <span class="dt">y =</span> passengers, <span class="dt">group =</span> year)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_group-1.png" width="288" style="display: block; margin: auto;" /><img src="_main_files/figure-html/graphiques_ggplot_group-2.png" width="288" style="display: block; margin: auto;" /></p>
<p>Si on veut tracer des lignes qui relient des points au sein d’un même groupe, alors que l’échelle est discrète, il est tout à fait possible d’indiquer un changement du groupement par défaut. Il suffit alors de préciser la valeur du groupe à l’argument <code>group</code> dans la fonction <code>aes()</code> de la fonction <code>geom_line()</code>.</p>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1163-1"><a href="graphiques.html#cb1163-1" aria-hidden="true"></a><span class="co"># Boxplot du nombre de passager pour chaque mois</span></span>
<span id="cb1163-2"><a href="graphiques.html#cb1163-2" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(month), <span class="dt">y =</span> passengers)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_group_2-1.png" width="288" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1164-1"><a href="graphiques.html#cb1164-1" aria-hidden="true"></a><span class="co"># En ajoutant les lignes de chaque année</span></span>
<span id="cb1164-2"><a href="graphiques.html#cb1164-2" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(month), <span class="dt">y =</span> passengers)) <span class="op">+</span></span>
<span id="cb1164-3"><a href="graphiques.html#cb1164-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb1164-4"><a href="graphiques.html#cb1164-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> year), <span class="dt">colour =</span> <span class="st">&quot;dodger blue&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_group_2-2.png" width="288" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_ggplot_annotations" class="section level3" number="5.2.6">
<h3><span class="header-section-number">5.2.6</span> Annotations</h3>
<p>L’annotation sur un graphique peut passer par du texte, ou bien par l’ajout d’objets géométriques (<em>e.g.</em>, des lignes ou des rectangles).</p>
<p>Les exemples qui suivent vont s’appuyer sur le graphique suivant.</p>
<div class="sourceCode" id="cb1165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1165-1"><a href="graphiques.html#cb1165-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1165-2"><a href="graphiques.html#cb1165-2" aria-hidden="true"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget, <span class="dt">y =</span> gross_revenue)) <span class="op">+</span></span>
<span id="cb1165-3"><a href="graphiques.html#cb1165-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<div id="graphiques_ggplot_annotations_texte" class="section level4" number="5.2.6.1">
<h4><span class="header-section-number">5.2.6.1</span> Texte</h4>
<p>Pour ajouter du texte sur les graphiques, il existe deux fonctions dans le <em>package</em> <code>ggplot</code> : <code>geom_text()</code> et <code>annotate()</code>, bien que la dernière soit plus générique (elle permet d’ajouter d’autres éléments que du texte). Nous ne présentons que la manière d’utiliser <code>annotate()</code>, dans la mesure où elle offre des performances accrues comparativement à <code>geom_text()</code>.</p>
<p>La fonction <code>annotate()</code>, dans le cas général, créé une nouvelle couche qui contient les annotations. Les données pour faire le lien avec les arguments esthétiques ne sont pas celles du tableau de données, mais contenues dans un vecteur qu’il est nécessaire de renseigner. Par ailleurs, la forme géométrique est à définir <em>via</em> l’argument <code>geom</code> (<code>"text"</code> pour du texte, ou encore <code>"segment"</code> pour un segment, etc.). Enfin, comme pour les couches de type <code>geom_*</code>, on peut rajouter des arguments esthétiques.</p>
<p>Pour ajouter du texte, on précise la position <code>x</code> et <code>y</code> (ou les positions, si on désire afficher plusieurs textes), l’argument <code>geom</code> doit recevoir la valeur <code>"text"</code> et l’argument <code>legend</code> se voit attribuer la chaîne à afficher (ou les chaînes en cas d’affichage de plusieurs textes)[^Les règles de recyclage s’appliquent !]. Si on souhaite afficher le texte d’une certaine couleur, on peut ajouter l’argument <code>colour</code> dans la fonction <code>annotate()</code>.</p>
<div class="sourceCode" id="cb1166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1166-1"><a href="graphiques.html#cb1166-1" aria-hidden="true"></a><span class="co"># Ajout d&#39;un texte simple</span></span>
<span id="cb1166-2"><a href="graphiques.html#cb1166-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">1e8</span>, <span class="dt">y =</span> <span class="fl">2e9</span>, <span class="dt">label =</span> <span class="st">&quot;Du texte&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_annotations_texte-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1167-1"><a href="graphiques.html#cb1167-1" aria-hidden="true"></a><span class="co"># Ajoute de deux textes, le premier en rouge, le second en bleu</span></span>
<span id="cb1167-2"><a href="graphiques.html#cb1167-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">1e8</span>, <span class="fl">2e8</span>), <span class="dt">y =</span> <span class="fl">2e9</span>,</span>
<span id="cb1167-3"><a href="graphiques.html#cb1167-3" aria-hidden="true"></a>             <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;Du texte&quot;</span>, <span class="st">&quot;Un autre texte&quot;</span>),</span>
<span id="cb1167-4"><a href="graphiques.html#cb1167-4" aria-hidden="true"></a>             <span class="dt">colour =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_annotations_texte-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>Dès lors que des lettres grecques doivent apparaître, ou bien des écritures en indice ou exposant, ou encore des symboles mathématiques, on peut rajouter l’argument <code>parse</code> évalué à <code>TRUE</code>. Pour faire apparaître une lettre grecque, il suffit d’écrire son nom. Pour écrire en indice, on utilise les crochets <code>[]</code> et pour écrire en exposant, l’accent circonflèxe <code>^</code>. Attention, pour ajouter un terme en indice et un en exposant, il est nécessaire de le faire dans l’ordre suivant : d’abord en indice, puis en exposant.</p>
<div class="sourceCode" id="cb1168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1168-1"><a href="graphiques.html#cb1168-1" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">1e8</span>, <span class="dt">y =</span> <span class="fl">2e9</span>,</span>
<span id="cb1168-2"><a href="graphiques.html#cb1168-2" aria-hidden="true"></a>             <span class="dt">label =</span> <span class="st">&quot;sqrt(1-alpha) + beta[i+1]^n&quot;</span>, <span class="dt">parse =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_annotations_expr-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Il est aussi possible, pour afficher des expressions mathématiques ou des lettres grecques, de faire appel à la fonction <code>TeX</code> du <em>package</em> {<code>latex2exp</code>}:</p>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1169-1"><a href="graphiques.html#cb1169-1" aria-hidden="true"></a><span class="kw">library</span>(latex2exp)</span>
<span id="cb1169-2"><a href="graphiques.html#cb1169-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">1e8</span>, <span class="dt">y =</span> <span class="fl">2e9</span>,</span>
<span id="cb1169-3"><a href="graphiques.html#cb1169-3" aria-hidden="true"></a>             <span class="dt">label =</span> <span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">sqrt{1-</span><span class="ch">\\</span><span class="st">alpha} + </span><span class="ch">\\</span><span class="st">beta^{n}_{i+1}$&quot;</span>,</span>
<span id="cb1169-4"><a href="graphiques.html#cb1169-4" aria-hidden="true"></a>                         <span class="dt">output =</span> <span class="st">&quot;character&quot;</span>),</span>
<span id="cb1169-5"><a href="graphiques.html#cb1169-5" aria-hidden="true"></a>             <span class="dt">parse =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-108-1.png" width="672" /></p>
</div>
<div id="graphiques_ggplot_annotations_lignes" class="section level4" number="5.2.6.2">
<h4><span class="header-section-number">5.2.6.2</span> Lignes</h4>
<p>Le <em>package</em> {<code>ggplot2</code>} contient quatre fonctions très utile pour ajouter des lignes sur un graphique, en plus des fonctions <code>geom_line()</code> et <code>geom_path()</code> :</p>
<ul>
<li><code>geom_vline()</code> : ligne verticale;</li>
<li><code>geom_hline()</code> : ligne horizontale;</li>
<li><code>geom_abline()</code> : ligne spécifiée par sa pente et son ordonnée à l’origine ;</li>
<li><code>geom_segment()</code> : segment ou flèche (en utilisant <code>arrow()</code>).</li>
</ul>
<div class="sourceCode" id="cb1170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1170-1"><a href="graphiques.html#cb1170-1" aria-hidden="true"></a><span class="co"># Ligne verticale</span></span>
<span id="cb1170-2"><a href="graphiques.html#cb1170-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">3e8</span>, <span class="dt">by =</span> <span class="fl">1e8</span>),</span>
<span id="cb1170-3"><a href="graphiques.html#cb1170-3" aria-hidden="true"></a>               <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&quot;dodger blue&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_annotations_lignes-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1171-1"><a href="graphiques.html#cb1171-1" aria-hidden="true"></a><span class="co"># Ligne horizontale</span></span>
<span id="cb1171-2"><a href="graphiques.html#cb1171-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">2e9</span>, <span class="dt">by =</span> <span class="fl">1e9</span>),</span>
<span id="cb1171-3"><a href="graphiques.html#cb1171-3" aria-hidden="true"></a>               <span class="dt">col =</span> <span class="st">&quot;gold&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;longdash&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_annotations_lignes-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1172-1"><a href="graphiques.html#cb1172-1" aria-hidden="true"></a><span class="co"># Droite</span></span>
<span id="cb1172-2"><a href="graphiques.html#cb1172-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="fl">1e9</span>, <span class="dt">slope =</span> <span class="dv">-5</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_annotations_lignes-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1173-1"><a href="graphiques.html#cb1173-1" aria-hidden="true"></a><span class="co"># Segment</span></span>
<span id="cb1173-2"><a href="graphiques.html#cb1173-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">xend =</span> <span class="fl">1e8</span>, </span>
<span id="cb1173-3"><a href="graphiques.html#cb1173-3" aria-hidden="true"></a>                     <span class="dt">y =</span> <span class="dv">0</span>, <span class="dt">yend =</span> <span class="fl">1e9</span>), <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_annotations_lignes-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>Pour les segments, il peut être plus intéressant d’utiliser la fonction <code>annotate()</code>, afin de s’affranchir de tout héritage des arguments de la fonction <code>ggplot()</code>.</p>
<div class="sourceCode" id="cb1174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1174-1"><a href="graphiques.html#cb1174-1" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;segment&quot;</span>,</span>
<span id="cb1174-2"><a href="graphiques.html#cb1174-2" aria-hidden="true"></a>             <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">xend =</span> <span class="fl">1e8</span>,</span>
<span id="cb1174-3"><a href="graphiques.html#cb1174-3" aria-hidden="true"></a>             <span class="dt">y =</span> <span class="dv">0</span>, <span class="dt">yend =</span> <span class="fl">1e9</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_annotations_lignes_annotate-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Pour tracer une flèche, il faut avoir recours à la fonction <code>arrow()</code> du <em>package</em> {<code>grid</code>}.</p>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1175-1"><a href="graphiques.html#cb1175-1" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;segment&quot;</span>, <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">xend =</span> <span class="fl">1e8</span>,</span>
<span id="cb1175-2"><a href="graphiques.html#cb1175-2" aria-hidden="true"></a>             <span class="dt">y =</span> <span class="dv">0</span>, <span class="dt">yend =</span> <span class="fl">1e9</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb1175-3"><a href="graphiques.html#cb1175-3" aria-hidden="true"></a>             <span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">length =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)))</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_annotations_lignes_arrow-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_ggplot_annotations_rect" class="section level4" number="5.2.6.3">
<h4><span class="header-section-number">5.2.6.3</span> Rectangles</h4>
<p>Pour ajouter un rectangle à un graphique, ce qui peut être pratique avec des données temporelles par exemple (<em>e.g.</em>, pour faire figurer les périodes de croissance ou de récession), on peut utiliser soit la fonction <code>geom_rect()</code>, soit à nouveau la fonction <code>annotate()</code>. Les deux méthodes fonctionnent à peu près de la même façon, mais encore une fois, <code>annotate()</code> permet de ne pas subir les héritages des arguments esthétiques.</p>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1176-1"><a href="graphiques.html#cb1176-1" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;rect&quot;</span>, <span class="dt">xmin =</span> <span class="fl">1e8</span>, <span class="dt">xmax =</span> <span class="fl">2e8</span>,</span>
<span id="cb1176-2"><a href="graphiques.html#cb1176-2" aria-hidden="true"></a>             <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>,</span>
<span id="cb1176-3"><a href="graphiques.html#cb1176-3" aria-hidden="true"></a>             <span class="dt">alpha =</span> <span class="fl">.3</span>, <span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb1176-4"><a href="graphiques.html#cb1176-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom  =</span><span class="st">&quot;rect&quot;</span>, <span class="dt">xmin =</span> <span class="dv">0</span>, <span class="dt">xmax =</span> <span class="fl">5e8</span>,</span>
<span id="cb1176-5"><a href="graphiques.html#cb1176-5" aria-hidden="true"></a>           <span class="dt">ymin =</span> <span class="fl">1e9</span>, <span class="dt">ymax =</span> <span class="fl">2e9</span>,</span>
<span id="cb1176-6"><a href="graphiques.html#cb1176-6" aria-hidden="true"></a>           <span class="dt">alpha =</span> <span class="fl">.2</span>, <span class="dt">fill =</span> <span class="st">&quot;dodger blue&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_annotations_rect-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="graphiques_ggplot_position" class="section level3" number="5.2.7">
<h3><span class="header-section-number">5.2.7</span> Positions</h3>
<p>Pour modifier le positionnement de certains éléments dans les graphiques, {<code>ggplot2</code>} propose cinq fonctions :</p>
<ul>
<li><code>position_dodge()</code> : évite les chevauchements, place les éléments côte à côte ;</li>
<li><code>position_fill()</code> : empile les éléments qui se chevauchent, en normalisant pour avoir une hauteur égale ;</li>
<li><code>position_identity()</code> : n’ajuste pas la position;</li>
<li><code>position_jitter()</code> : place les éméments côte à côte en essyant d’optimiser l’espace ;</li>
<li><code>position_stack()</code> : empile les éléments qui se chevauchent.</li>
</ul>
<p>La manière la plus simple d’utiliser ces fonctions est de les appeler à travers l’argument <code>position</code> d’une fonction <code>geom_*</code>, en précisant uniquement le suffixe. Par exemple, avec un diagramme en bâton, pour que les barres soient côte à côte, on indique <code>position = "dodge"</code> à la fonction `geom_bar()}.</p>
<p>Encore une fois, même s’il est possible de réaliser une action avec une fonction de {<code>ggplot2</code>}, cela ne veut pas forcément dire que cette action est adaptée à une lecture facilitée. Ainsi, lorsque l’on fournit la valeur <code>"identity"</code> à l’argument <code>position</code> de la fonction <code>geom_bar()</code>, les barres s’entre-mêlent, et certaines peuvent devenir invisibles, cachées par une autre.</p>
<p>Les exemples ci-après montrent toutes les possibilités de placement pour un diagramme en bâton.</p>
<div class="sourceCode" id="cb1177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1177-1"><a href="graphiques.html#cb1177-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1177-2"><a href="graphiques.html#cb1177-2" aria-hidden="true"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> runtime, <span class="dt">fill =</span> country_abr))</span>
<span id="cb1177-3"><a href="graphiques.html#cb1177-3" aria-hidden="true"></a><span class="kw">library</span>(grid)</span>
<span id="cb1177-4"><a href="graphiques.html#cb1177-4" aria-hidden="true"></a>p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span></span>
<span id="cb1177-5"><a href="graphiques.html#cb1177-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">5</span>),</span>
<span id="cb1177-6"><a href="graphiques.html#cb1177-6" aria-hidden="true"></a>        <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(.<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1177-7"><a href="graphiques.html#cb1177-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_fill_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Country&quot;</span>)</span>
<span id="cb1177-8"><a href="graphiques.html#cb1177-8" aria-hidden="true"></a></span>
<span id="cb1177-9"><a href="graphiques.html#cb1177-9" aria-hidden="true"></a><span class="co"># Dodge</span></span>
<span id="cb1177-10"><a href="graphiques.html#cb1177-10" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_position-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1178-1"><a href="graphiques.html#cb1178-1" aria-hidden="true"></a><span class="co"># Fill</span></span>
<span id="cb1178-2"><a href="graphiques.html#cb1178-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_position-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1179-1"><a href="graphiques.html#cb1179-1" aria-hidden="true"></a><span class="co"># Identity (pas pratique avec un barchart)</span></span>
<span id="cb1179-2"><a href="graphiques.html#cb1179-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.8</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_position-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1180-1"><a href="graphiques.html#cb1180-1" aria-hidden="true"></a><span class="co"># Jitter</span></span>
<span id="cb1180-2"><a href="graphiques.html#cb1180-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;jitter&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_position-4.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1181-1"><a href="graphiques.html#cb1181-1" aria-hidden="true"></a><span class="co"># Stack</span></span>
<span id="cb1181-2"><a href="graphiques.html#cb1181-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_position-5.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_ggplot_facet" class="section level3" number="5.2.8">
<h3><span class="header-section-number">5.2.8</span> Facettes</h3>
<p>Tout comme pour <code>qplot()</code>, on peut créer des facettes, c’est-à-dire produire des graphique de même type pour différentes sous-divisions du tableau de données, et les aligner sur une grille. {<code>ggplot2</code>} propose deux fonctions pour faire du <em>fateting</em> : <code>facet_grid()</code> (produisant une grille à deux dimensions, pour laquelle les variables définissent les lignes et colonnes) et <code>facet_wrap()</code> (produisant les graphiques pour chaque sous-division, qui sont ensuite placés sur une grille à deux dimension, les uns après les autres).</p>
<p>Les deux arguments principaux de ces fonctions sont : les variables servant à faire le <em>faceting</em>, sour forme de formule, et un logique indiquant si les échelles de positions doivent être globales ou bien locales à chaque facette.</p>
<p>Pour être plus précis avec les exemples, nous avons besoin d’une seconde variable qualitative avec peu de modalités. Prenons arbitrairement une variable indicatrice, valant <code>nouveau</code> pour les films produits après 2000, et <code>ancien</code> sinon.</p>
<div class="sourceCode" id="cb1182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1182-1"><a href="graphiques.html#cb1182-1" aria-hidden="true"></a>films_reduit<span class="op">$</span>old &lt;-<span class="st"> </span></span>
<span id="cb1182-2"><a href="graphiques.html#cb1182-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">ifelse</span>(films_reduit<span class="op">$</span>year <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2000</span>, <span class="st">&quot;ancien&quot;</span>, <span class="st">&quot;nouveau&quot;</span>)</span></code></pre></div>
<div id="graphiques_ggplot_facet_grid" class="section level4" number="5.2.8.1">
<h4><span class="header-section-number">5.2.8.1</span> La fonction <code>facet_grid()</code></h4>
<p>Pour créer une grille sur laquelle les colonnes et les lignes servent à différentier différentes modalités de variables, on utilise la fonction <code>facet_grid()</code>. L’argument <code>facets</code> attend une formule, dont la syntaxe est la suivante : <code>variable_ligne ~ variable_colonne</code>, avec <code>variable_ligne</code> le nom de la variable facteur en ligne, et <code>variable_colonne</code> le nom de la variable facteur en colonne. Le symbole <code>.</code> indique que l’on ne souhaite pas créer de facette sur la dimension :</p>
<ul>
<li><code>.~.</code> (la valeur par défaut) : ne pas faire de <em>faceting</em> ;</li>
<li><code>. ~ variable_colonne</code> : une ligne, autant de colonnes que de valeurs possibles pour <code>variable_colonne</code> ;</li>
<li><code>variable_ligne ~ .</code> : autant de lignes que de valeurs possibles pour <code>variable_ligne</code>, une seule colonne ;</li>
<li><code>variable_ligne ~ variable_colonne</code> : autant de lignes que de valeurs possibles pour <code>variable_ligne</code>, autant de colonnes que de valeurs possibles pour <code>variable_colonne</code>.</li>
</ul>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1183-1"><a href="graphiques.html#cb1183-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1183-2"><a href="graphiques.html#cb1183-2" aria-hidden="true"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget,</span>
<span id="cb1183-3"><a href="graphiques.html#cb1183-3" aria-hidden="true"></a>                <span class="dt">y =</span> gross_revenue,</span>
<span id="cb1183-4"><a href="graphiques.html#cb1183-4" aria-hidden="true"></a>                <span class="dt">colour =</span> country,</span>
<span id="cb1183-5"><a href="graphiques.html#cb1183-5" aria-hidden="true"></a>                <span class="dt">size =</span> runtime)) <span class="op">+</span></span>
<span id="cb1183-6"><a href="graphiques.html#cb1183-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb1183-7"><a href="graphiques.html#cb1183-7" aria-hidden="true"></a></span>
<span id="cb1183-8"><a href="graphiques.html#cb1183-8" aria-hidden="true"></a><span class="co"># Avec une colonne pour chaque pays</span></span>
<span id="cb1183-9"><a href="graphiques.html#cb1183-9" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>country)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_facet_grid-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1184-1"><a href="graphiques.html#cb1184-1" aria-hidden="true"></a><span class="co"># Avec en ligne la récence du film, et en colonne le pays</span></span>
<span id="cb1184-2"><a href="graphiques.html#cb1184-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(old <span class="op">~</span><span class="st"> </span>country)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_facet_grid-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>On peut ajouter une option pour avoir les situations marginales (similairement au tableau obtenu, dans le cas de deux variables aléatoires discrètes, faisant figurer les lois marginales en bout de ligne et de colonne). Pour ce faire, il faut attribuer la valeur <code>TRUE</code> à l’argument <code>margins</code>. Si on souhaite afficher uniquement les facettes supplémentaires pour une variable mais pas les deux, il faut fournir le nom de cette variable à l’argument <code>margins</code>.</p>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1185-1"><a href="graphiques.html#cb1185-1" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(old <span class="op">~</span><span class="st"> </span>country, <span class="dt">margins =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_facet_grid_margins-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1186-1"><a href="graphiques.html#cb1186-1" aria-hidden="true"></a><span class="co"># Ajout d&#39;une facette avec tous les pays, en différenciant par ligne (récence)</span></span>
<span id="cb1186-2"><a href="graphiques.html#cb1186-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(old <span class="op">~</span><span class="st"> </span>country, <span class="dt">margins =</span> <span class="st">&quot;country&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_facet_grid_margins-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_ggplot_facet_wrap" class="section level4" number="5.2.8.2">
<h4><span class="header-section-number">5.2.8.2</span> La fonction <code>facet_wrap()</code></h4>
<p>La fonction <code>facet_wrap()</code> fonctionne un peu différemment de <code>facet_grid()</code>. En effet, au lieu de travailler en fonction de variables par lignes et par colonnes, elle crée une succession de graphiques qui sont <strong>par la suite</strong> placés sur une grille à deux dimensions. Pour créer les facette, il faut renseigner une formule à l’argument <code>facets</code>. La syntaxe pour la formule est la suivante : <code>~ variable_1 + variable_2 + ... variable_n</code>. La grille finale sera ce qui se rapproche le plus d’un carré. Dans les cas où ce n’est pas possible, la grille sera plutôt large que longue (nos écrans sont généralement configurés ainsi, ce qui explique ce choix).</p>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1187-1"><a href="graphiques.html#cb1187-1" aria-hidden="true"></a><span class="co"># Avec une seule variable</span></span>
<span id="cb1187-2"><a href="graphiques.html#cb1187-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="dt">facets =</span> <span class="op">~</span><span class="st"> </span>country)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_facet_wrap-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1188-1"><a href="graphiques.html#cb1188-1" aria-hidden="true"></a><span class="co"># Avec deux variables</span></span>
<span id="cb1188-2"><a href="graphiques.html#cb1188-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="dt">facets =</span> <span class="op">~</span><span class="st"> </span>country <span class="op">+</span><span class="st"> </span>old)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_facet_wrap-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_ggplot_facet_scales" class="section level4" number="5.2.8.3">
<h4><span class="header-section-number">5.2.8.3</span> Échelles et facettes</h4>
<p>Que ce soit pour <code>facet_grid()</code> ou <code>facet_wrap()</code>, il est possible de préciser si les échelles de positions doivent s’appliquer à tous les graphiques de la grille, ou bien doivent varier. Cela se fait <em>via</em> l’argument <code>scales</code>. On distingue quatre options :</p>
<ul>
<li><code>fixed</code> : les échelles les fixes, identiques pour chaque graphique ;</li>
<li><code>free</code> : les échelles peuvent varier en fonction de chaque graphique de la grille ;</li>
<li><code>free_x</code> : seule l’échelle pour les <code>x</code> peut varier, l’échelle pour les <code>y</code> est fixe, commune à chaque graphique de la grille ;</li>
<li><code>free_y</code> : seule l’échelle pour les <code>y</code> peut varier, l’échelle pour les <code>x</code> est fixe, commune à chaque graphique de la grille.</li>
</ul>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1189-1"><a href="graphiques.html#cb1189-1" aria-hidden="true"></a>p_m &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1189-2"><a href="graphiques.html#cb1189-2" aria-hidden="true"></a>       <span class="kw">aes</span>(estimated_budget<span class="op">/</span><span class="dv">1000000</span>, </span>
<span id="cb1189-3"><a href="graphiques.html#cb1189-3" aria-hidden="true"></a>           gross_revenue<span class="op">/</span><span class="dv">1000000</span>, </span>
<span id="cb1189-4"><a href="graphiques.html#cb1189-4" aria-hidden="true"></a>           <span class="dt">colour =</span> country, </span>
<span id="cb1189-5"><a href="graphiques.html#cb1189-5" aria-hidden="true"></a>           <span class="dt">size =</span> runtime)) <span class="op">+</span></span>
<span id="cb1189-6"><a href="graphiques.html#cb1189-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb1189-7"><a href="graphiques.html#cb1189-7" aria-hidden="true"></a></span>
<span id="cb1189-8"><a href="graphiques.html#cb1189-8" aria-hidden="true"></a><span class="co"># Toutes les échelles identiques</span></span>
<span id="cb1189-9"><a href="graphiques.html#cb1189-9" aria-hidden="true"></a>p_m <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>country, <span class="dt">scales =</span> <span class="st">&quot;fixed&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_facet_scales-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1190-1"><a href="graphiques.html#cb1190-1" aria-hidden="true"></a><span class="co"># Échelles variant pour chaque graphique de la grille</span></span>
<span id="cb1190-2"><a href="graphiques.html#cb1190-2" aria-hidden="true"></a>p_m <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>country, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_facet_scales-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="graphiques_ggplot_coord" class="section level3" number="5.2.9">
<h3><span class="header-section-number">5.2.9</span> Coordonnées</h3>
<p>Le <em>package</em> {<code>ggplot2</code>} gère plusieurs systèmes de coordonnées différents, le système cartésien étant celui utilisé par défaut. Pour définir le système souhaité, il faut faire appel aux fonctions commençant par <code>coord_</code> :</p>
<ul>
<li><code>coord_cartesian()</code> : coordonnées cartésiennes ;</li>
<li><code>coord_fixed()</code> : coordonnées cartésiennes avec la même échelle pour les deux axes ;</li>
<li><code>coord_flip()</code> : coordonnées cartésiennes avec les axes renversés ;</li>
<li><code>coord_map()</code> : projections pour les cartes ;</li>
<li><code>coord_polar()</code> : coordonnées polaires ;</li>
<li><code>coord_trans()</code> : coordonnées cartésiennes transformées.</li>
</ul>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1191-1"><a href="graphiques.html#cb1191-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films,</span>
<span id="cb1191-2"><a href="graphiques.html#cb1191-2" aria-hidden="true"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget<span class="op">/</span><span class="fl">1e6</span>,</span>
<span id="cb1191-3"><a href="graphiques.html#cb1191-3" aria-hidden="true"></a>                <span class="dt">y =</span> gross_revenue<span class="op">/</span><span class="fl">1e6</span>)) <span class="op">+</span></span>
<span id="cb1191-4"><a href="graphiques.html#cb1191-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb1191-5"><a href="graphiques.html#cb1191-5" aria-hidden="true"></a><span class="co"># En renversant les axes</span></span>
<span id="cb1191-6"><a href="graphiques.html#cb1191-6" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_coord-1.png" width="192" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1192-1"><a href="graphiques.html#cb1192-1" aria-hidden="true"></a><span class="co"># En effectuant une transformation du système de coordonnées</span></span>
<span id="cb1192-2"><a href="graphiques.html#cb1192-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">coord_trans</span>(<span class="dt">x =</span> <span class="st">&quot;log10&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;log10&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_coord-2.png" width="192" style="display: block; margin: auto;" /></p>

<div class="remarque">
<p>Nous avons vu que la fonction <code>scale_x_log10()</code> (Section @ref(graphiques_ggplot_scale)) permet aussi de changer les échelles en échelles logarithmiques. Cependant, il y a une petite différence : avec <code>coord_trans</code>, la transformation est réalisée après la réalisation de statistiques. Cela a un impact, par exemple, sur les lignes du quadrillage</p>
</div>
<div class="sourceCode" id="cb1193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1193-1"><a href="graphiques.html#cb1193-1" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_coord_remarque-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_ggplot_axes" class="section level3" number="5.2.10">
<h3><span class="header-section-number">5.2.10</span> Titres, axes, légendes</h3>
<p>Jusqu’ici, les graphiques proposés en exemple souffrent pour la plupart de l’absence de titre, de légendes illisibles, etc. Heureusement, tout cela est paramétrable !</p>
<p>Pour ajouter un titre, rien de plus simple : faire appel à la fonction <code>ggtitle()</code>, et fournir le titre à l’argument <code>label</code>. Pour changer les étiquettes des axes, on peut faire appel aux fonctions <code>xlab()</code> et <code>ylab()</code> pour l’axe des <code>x</code> et des <code>y</code> respectivement, et renseigner l’argument <code>label</code>.</p>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1194-1"><a href="graphiques.html#cb1194-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films,</span>
<span id="cb1194-2"><a href="graphiques.html#cb1194-2" aria-hidden="true"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget<span class="op">/</span><span class="fl">1e6</span>,</span>
<span id="cb1194-3"><a href="graphiques.html#cb1194-3" aria-hidden="true"></a>                <span class="dt">y =</span> gross_revenue<span class="op">/</span><span class="fl">1e6</span>)) <span class="op">+</span></span>
<span id="cb1194-4"><a href="graphiques.html#cb1194-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1194-5"><a href="graphiques.html#cb1194-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Titre&quot;</span>) <span class="op">+</span></span>
<span id="cb1194-6"><a href="graphiques.html#cb1194-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Étiquette axe des x&quot;</span>) <span class="op">+</span></span>
<span id="cb1194-7"><a href="graphiques.html#cb1194-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Étiquette axe des y&quot;</span>)</span></code></pre></div>
<p>La fonction <code>labs()</code> permet de gérer les trois en même temps :</p>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1195-1"><a href="graphiques.html#cb1195-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films,</span>
<span id="cb1195-2"><a href="graphiques.html#cb1195-2" aria-hidden="true"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget<span class="op">/</span><span class="fl">1e6</span>,</span>
<span id="cb1195-3"><a href="graphiques.html#cb1195-3" aria-hidden="true"></a>                <span class="dt">y =</span> gross_revenue<span class="op">/</span><span class="fl">1e6</span>)) <span class="op">+</span></span>
<span id="cb1195-4"><a href="graphiques.html#cb1195-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1195-5"><a href="graphiques.html#cb1195-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1195-6"><a href="graphiques.html#cb1195-6" aria-hidden="true"></a>    <span class="dt">title =</span> <span class="st">&quot;Titre&quot;</span>,</span>
<span id="cb1195-7"><a href="graphiques.html#cb1195-7" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;Étiquette axe des x&quot;</span>,</span>
<span id="cb1195-8"><a href="graphiques.html#cb1195-8" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="st">&quot;Étiquette axe des y&quot;</span></span>
<span id="cb1195-9"><a href="graphiques.html#cb1195-9" aria-hidden="true"></a>  )</span></code></pre></div>
<p>Pour définir manuellement les limites des axes, on peut utiliser les fonctions <code>xlim()</code> et <code>ylim()</code>. Attention toutefois, les valeurs en dehors des intervalles définis seront complètement jetées, les autres couches hériteront des données appartenant aux intervalles définis. Pour changer les limites des axes sans jeter de données, il faut faire appel à la fonction <code>coord_cartesian()</code>.</p>
<div class="sourceCode" id="cb1196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1196-1"><a href="graphiques.html#cb1196-1" aria-hidden="true"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">10</span>), </span>
<span id="cb1196-2"><a href="graphiques.html#cb1196-2" aria-hidden="true"></a>             <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">15</span>, <span class="dv">10</span>),</span>
<span id="cb1196-3"><a href="graphiques.html#cb1196-3" aria-hidden="true"></a>             <span class="dt">g =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">each =</span> <span class="dv">4</span>)))</span>
<span id="cb1196-4"><a href="graphiques.html#cb1196-4" aria-hidden="true"></a></span>
<span id="cb1196-5"><a href="graphiques.html#cb1196-5" aria-hidden="true"></a>p_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">group =</span> g, <span class="dt">fill =</span> g)) <span class="op">+</span></span>
<span id="cb1196-6"><a href="graphiques.html#cb1196-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_polygon</span>()</span>
<span id="cb1196-7"><a href="graphiques.html#cb1196-7" aria-hidden="true"></a>p_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">group =</span> g, <span class="dt">fill =</span> g)) <span class="op">+</span></span>
<span id="cb1196-8"><a href="graphiques.html#cb1196-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_polygon</span>() <span class="op">+</span></span>
<span id="cb1196-9"><a href="graphiques.html#cb1196-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb1196-10"><a href="graphiques.html#cb1196-10" aria-hidden="true"></a></span>
<span id="cb1196-11"><a href="graphiques.html#cb1196-11" aria-hidden="true"></a><span class="co"># Le graphique par défaut</span></span>
<span id="cb1196-12"><a href="graphiques.html#cb1196-12" aria-hidden="true"></a>p_<span class="dv">2</span></span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_axes_limites-1.png" width="192" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1197-1"><a href="graphiques.html#cb1197-1" aria-hidden="true"></a><span class="co"># En jouant avec la limite des x avec la fonction xlim()</span></span>
<span id="cb1197-2"><a href="graphiques.html#cb1197-2" aria-hidden="true"></a>p_<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">xlim</span>(<span class="dv">0</span>, <span class="dv">7</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_axes_limites-2.png" width="192" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1198-1"><a href="graphiques.html#cb1198-1" aria-hidden="true"></a><span class="co"># Avec la fonction coord_cartesian()</span></span>
<span id="cb1198-2"><a href="graphiques.html#cb1198-2" aria-hidden="true"></a>p_<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">7</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_axes_limites-3.png" width="192" style="display: block; margin: auto;" /></p>
<p>Le changement des arguments des légendes est un peu moins simple. Il faut passer par la fonction <code>theme()</code>. Le lecteur ou la lectrice est invité•e à consulter la page d’aide de la fonction à l’adresse suivante : <a href="http://docs.ggplot2.org/current/theme.html" class="uri">http://docs.ggplot2.org/current/theme.html</a>. Dès que l’on souhaite modifier l’aspect de la légende, des marques des axes, des étiquettes des axes, des lignes principales et secondaires formant le quadrillage, etc. il faut utiliser la fonction <code>theme()</code>.</p>
<p>Les éléments pouvant être changés sont nombreux. Il y a quatre types de fonctions pour modifier les éléments :</p>
<ul>
<li><p><code>element_text()</code> : pour toutes les étiquettes, ce qui est au format texte. On peut modifier :</p>
<ul>
<li><code>family</code> : la famille de la fonte,</li>
<li><code>face</code> : graisse (“plain”, “italic”, “bold”, “bold.italic”),</li>
<li><code>colour</code> : couleur,</li>
<li><code>size</code> : taille en pts,</li>
<li><code>hjust</code> : justification horizontale, dans [0, 1],</li>
<li><code>vjust</code> : justification verticale, dans [0, 1],</li>
<li><code>angle</code> : angle, dans [0, 360],</li>
<li><code>lineheight</code> : hauteur de ligne (pour l’espacement entre les lignes) ;</li>
</ul></li>
<li><p><code>element_line()</code> : pour toutes les lignes tracées. On peut modifier :</p>
<ul>
<li><code>colour</code> : la couleur de ligne,</li>
<li><code>size</code> : la taille,</li>
<li><code>linetype</code> : le type de ligne (“blank”, “solid”, “dashed”, “dotted”, “dotdash”, “longdash”, "twodash),</li>
<li><code>lineend</code> : le type de fin de ligne (“round”, “butt” ou “square”) ;</li>
</ul></li>
<li><p><code>element_rect()</code> : pour les backgrounds et les cadres. On peut modifier :</p>
<ul>
<li><code>fill</code> : la couleur de remplissage,</li>
<li><code>colour</code> : la couleur de la bordure,</li>
<li><code>size</code> : la taille de la bordure,</li>
<li><code>linetype</code> : le type de ligne (“blank”, “solid”, “dashed”, “dotted”, “dotdash”, “longdash”, "twodash) ;</li>
</ul></li>
<li><p><code>element_blank()</code> permet de ne rien dessiner.</p></li>
</ul>
<div class="sourceCode" id="cb1199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1199-1"><a href="graphiques.html#cb1199-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit,</span>
<span id="cb1199-2"><a href="graphiques.html#cb1199-2" aria-hidden="true"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget<span class="op">/</span><span class="fl">1e6</span>, </span>
<span id="cb1199-3"><a href="graphiques.html#cb1199-3" aria-hidden="true"></a>                <span class="dt">y =</span> gross_revenue<span class="op">/</span><span class="fl">1e6</span>,</span>
<span id="cb1199-4"><a href="graphiques.html#cb1199-4" aria-hidden="true"></a>                <span class="dt">colour =</span> country_abr)) <span class="op">+</span></span>
<span id="cb1199-5"><a href="graphiques.html#cb1199-5" aria-hidden="true"></a><span class="st">  </span><span class="co"># Tracer des points</span></span>
<span id="cb1199-6"><a href="graphiques.html#cb1199-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1199-7"><a href="graphiques.html#cb1199-7" aria-hidden="true"></a><span class="st">  </span><span class="co"># Ajout d&#39;un titre</span></span>
<span id="cb1199-8"><a href="graphiques.html#cb1199-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Titre</span><span class="ch">\n</span><span class="st">sur deux lignes&quot;</span>) <span class="op">+</span></span>
<span id="cb1199-9"><a href="graphiques.html#cb1199-9" aria-hidden="true"></a><span class="st">  </span><span class="co"># Changement des étiquettes pour les axes</span></span>
<span id="cb1199-10"><a href="graphiques.html#cb1199-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Étiquette axe des x&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Étiquette axe des y&quot;</span>) <span class="op">+</span></span>
<span id="cb1199-11"><a href="graphiques.html#cb1199-11" aria-hidden="true"></a><span class="st">  </span><span class="co"># Changement du titre de la légende</span></span>
<span id="cb1199-12"><a href="graphiques.html#cb1199-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_colour_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Country&quot;</span>)</span>
<span id="cb1199-13"><a href="graphiques.html#cb1199-13" aria-hidden="true"></a></span>
<span id="cb1199-14"><a href="graphiques.html#cb1199-14" aria-hidden="true"></a><span class="co"># Le graphique par défaut</span></span>
<span id="cb1199-15"><a href="graphiques.html#cb1199-15" aria-hidden="true"></a>p</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_axes_theme-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1200-1"><a href="graphiques.html#cb1200-1" aria-hidden="true"></a><span class="co"># En changeant certains éléments</span></span>
<span id="cb1200-2"><a href="graphiques.html#cb1200-2" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>,</span>
<span id="cb1200-3"><a href="graphiques.html#cb1200-3" aria-hidden="true"></a>                       <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb1200-4"><a href="graphiques.html#cb1200-4" aria-hidden="true"></a>                       <span class="dt">size =</span> <span class="kw">rel</span>(<span class="dv">2</span>),</span>
<span id="cb1200-5"><a href="graphiques.html#cb1200-5" aria-hidden="true"></a>                       <span class="dt">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb1200-6"><a href="graphiques.html#cb1200-6" aria-hidden="true"></a>                       <span class="dt">lineheight =</span> <span class="fl">1.5</span>),</span>
<span id="cb1200-7"><a href="graphiques.html#cb1200-7" aria-hidden="true"></a>          <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;orange&quot;</span>),</span>
<span id="cb1200-8"><a href="graphiques.html#cb1200-8" aria-hidden="true"></a>          <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">angle =</span> <span class="dv">45</span>),</span>
<span id="cb1200-9"><a href="graphiques.html#cb1200-9" aria-hidden="true"></a>          <span class="dt">axis.ticks =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;brown&quot;</span>, <span class="dt">size =</span> <span class="kw">rel</span>(<span class="dv">2</span>)),</span>
<span id="cb1200-10"><a href="graphiques.html#cb1200-10" aria-hidden="true"></a>          <span class="dt">legend.key =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;dodger blue&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>),</span>
<span id="cb1200-11"><a href="graphiques.html#cb1200-11" aria-hidden="true"></a>          <span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;green&quot;</span>,</span>
<span id="cb1200-12"><a href="graphiques.html#cb1200-12" aria-hidden="true"></a>                                           <span class="dt">colour =</span> <span class="st">&quot;purple&quot;</span>,</span>
<span id="cb1200-13"><a href="graphiques.html#cb1200-13" aria-hidden="true"></a>                                           <span class="dt">linetype =</span> <span class="st">&quot;twodash&quot;</span>),</span>
<span id="cb1200-14"><a href="graphiques.html#cb1200-14" aria-hidden="true"></a>          <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb1200-15"><a href="graphiques.html#cb1200-15" aria-hidden="true"></a>          <span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb1200-16"><a href="graphiques.html#cb1200-16" aria-hidden="true"></a>          )</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_axes_theme-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>Comme on peut le voir, changer les arguments graphiques peut facilement produire un graphique difficile à lire. Le thème par défaut dans {<code>ggplot2</code>} a été étudié, il convient dans de nombreux cas (pour un affichage sur un écran d’ordinateur). Mais on est parfois amené à effectuer quelques changements, d’où l’importance deprésenter la méthode pour réaliser ces changements. Par ailleurs, il existe d’autres thèmes réfléchis dans le <em>package</em> {<code>ggplot2</code>}, parmi lesquels <code>theme_bw()</code> (<em>background</em> blanc et grilles noires) ou <code>theme_grey()</code> (<em>background</em> gris et grilles blanches) ou encore <code>theme_mini()</code> (pour un affichage minimaliste).</p>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1201-1"><a href="graphiques.html#cb1201-1" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_axes_theme_3-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Certains développent des thèmes supplémentaires. Voir par exemple sur ce  : .</p>
<p>Depuis 2020, il est possible dans {<code>ggplot2</code>} de choisir d’afficher le titre du graphique tout à gauche, aligné avec les étiquettes de l’axe des ordonnées, en renseignant à <code>"plot"</code> l’argument <code>plot.title.position</code> de la fonction <code>theme()</code> :</p>
<div class="sourceCode" id="cb1202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1202-1"><a href="graphiques.html#cb1202-1" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_ggplot_axes_theme_title_pos-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Pour aller plus loin sur la conception des graphiques, je vous propose deux pistes :</p>
<ol style="list-style-type: decimal">
<li>La présentation filmée de William Chase intitulée “<a href="https://rstudio.com/resources/rstudioconf-2020/the-glamour-of-graphics/">The Glamour of Graphics</a>”, donnée le 30 janvier 2020 à la conférence RStudio ;</li>
<li>Un article intitulé “<a href="https://www.aeaweb.org/articles?id=10.1257/jep.28.1.209">An Economist’s Guide to Visualizing Data</a>”, rédigé par Jonathan A. Schwabish et publié dans Journal of Economic Perspectives <span class="citation">(Schwabish <a href="#ref-schwabish2014economist" role="doc-biblioref">2014</a>)</span>.</li>
</ol>
</div>
</div>
<div id="graphiques_enregistrement" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Enregistrement des graphiques</h2>
<p>Pour enregistrer un graphique créé avec la fonction <code>qplot()</code> ou <code>ggplot()</code>, rien de plus simple : la fonction <code>ggsave()</code>. Ses arguments sont les suivants :</p>
<ul>
<li><code>filename</code> : nom du fichier, ou chemin et nom du fichier;</li>
<li><code>plot</code> : graphique à sauvegarder (par défaut, le dernier graphique, en faisant appel à la fonction <code>last_plot()</code>;</li>
<li><code>device</code> : dispositif à utiliser (automatiquement extrait de l’extension du fichier indiqué à l’argument <code>filename</code>);</li>
<li><code>path</code> : chemin vers le fichier ;</li>
<li><code>scale</code> : facteur d’échelle;</li>
<li><code>width</code> : largeur (par défaut, celle de la fenêtre de graphique actuelle) ;</li>
<li><code>height</code> : hauteur (par défaut, celle de la fenêtre de graphique actuelle) ;</li>
<li><code>units</code> : unité pour la largeur et la longueur (<code>"in"</code>, <code>"cm"</code> ou <code>"mm"</code>);</li>
<li><code>dpi</code> : nombre de points par pouce, uniquement pour les images matricielles ;</li>
<li><code>limitsize</code> : quand <code>TRUE</code> (la valeur par défaut), l’image sauvegardée ne dépassera pas les <span class="math inline">\(50\times 50\)</span> in.</li>
</ul>
<p>La fonction <code>ggsave()</code> est capable de reconnaître les extensions de fichiers suivants :<code>eps/ps</code>, <code>tex</code>, <code>pdf</code>, <code>jpeg</code>, <code>tiff</code>, <code>png</code>, <code>bmp</code>, <code>svg</code> et <code>wmf</code> (ce dernier étant valable uniquement pour Windows).</p>
<div class="sourceCode" id="cb1203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1203-1"><a href="graphiques.html#cb1203-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> films_reduit, </span>
<span id="cb1203-2"><a href="graphiques.html#cb1203-2" aria-hidden="true"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> estimated_budget,</span>
<span id="cb1203-3"><a href="graphiques.html#cb1203-3" aria-hidden="true"></a>                <span class="dt">y =</span> gross_revenue,</span>
<span id="cb1203-4"><a href="graphiques.html#cb1203-4" aria-hidden="true"></a>                <span class="dt">colour =</span> country)) <span class="op">+</span></span>
<span id="cb1203-5"><a href="graphiques.html#cb1203-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Estimated budget&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Gross Revenue&quot;</span>) <span class="op">+</span></span>
<span id="cb1203-6"><a href="graphiques.html#cb1203-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_colour_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Country&quot;</span>) <span class="op">+</span></span>
<span id="cb1203-7"><a href="graphiques.html#cb1203-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;A small sample of movies&quot;</span>)</span>
<span id="cb1203-8"><a href="graphiques.html#cb1203-8" aria-hidden="true"></a></span>
<span id="cb1203-9"><a href="graphiques.html#cb1203-9" aria-hidden="true"></a>p</span>
<span id="cb1203-10"><a href="graphiques.html#cb1203-10" aria-hidden="true"></a></span>
<span id="cb1203-11"><a href="graphiques.html#cb1203-11" aria-hidden="true"></a><span class="co"># Sauvegarde dans le répertoire de travail,</span></span>
<span id="cb1203-12"><a href="graphiques.html#cb1203-12" aria-hidden="true"></a><span class="co"># au format pdf, le dernier graphique affiché créé via ggplot2,</span></span>
<span id="cb1203-13"><a href="graphiques.html#cb1203-13" aria-hidden="true"></a><span class="co"># aux dimensions égales à la fenêtre des graphiques</span></span>
<span id="cb1203-14"><a href="graphiques.html#cb1203-14" aria-hidden="true"></a><span class="kw">ggsave</span>(<span class="st">&quot;estim_bud.pdf&quot;</span>)</span>
<span id="cb1203-15"><a href="graphiques.html#cb1203-15" aria-hidden="true"></a></span>
<span id="cb1203-16"><a href="graphiques.html#cb1203-16" aria-hidden="true"></a></span>
<span id="cb1203-17"><a href="graphiques.html#cb1203-17" aria-hidden="true"></a><span class="co"># En précisant plus d&#39;arguments</span></span>
<span id="cb1203-18"><a href="graphiques.html#cb1203-18" aria-hidden="true"></a><span class="kw">ggsave</span>(p, </span>
<span id="cb1203-19"><a href="graphiques.html#cb1203-19" aria-hidden="true"></a>       <span class="dt">file =</span> <span class="st">&quot;estim_bud.pdf&quot;</span>, <span class="dt">width =</span> <span class="dv">15</span>, <span class="dt">height =</span> <span class="dv">8</span>,</span>
<span id="cb1203-20"><a href="graphiques.html#cb1203-20" aria-hidden="true"></a>       <span class="dt">unit =</span> <span class="st">&quot;cm&quot;</span>, <span class="dt">scale =</span> <span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="graphiques_maps" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Cartes</h2>
<p>Avec {<code>ggplot2</code>}, il est très facile de dessiner des cartes. Il faut cependant charger quelques autres <em>packages</em>. Attention, le but de cette section est de montrer des méthodes pour dessiner des cartes. Le lecteur ou la lectrie intéressé•e par les traitements des données spatiales ne trouvera pas satisfaction avec cette introduction à l’utilisation de <code>R</code> et devra plutôt consulter d’autres références (<em>e.g.</em>, <span class="citation">Bivand, Pebesma, and Gómez-Rubio (<a href="#ref-Bivand_2008_Applied" role="doc-biblioref">n.d.</a>)</span>).</p>
<div id="graphiques_maps_recup" class="section level3" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Récupérer des cartes toutes faites</h3>
<p>La première chose nécessaire à la création d’une carte, est de disposer des données pour pouvoir tracer les frontières. Dans les cas les plus simples, on peut récupérer des jeux de données présents dans des <em>packages</em>.</p>
<div id="graphiques_maps_recup_rworldmap" class="section level4" number="5.4.1.1">
<h4><span class="header-section-number">5.4.1.1</span> <em>Package</em> <code>rworldmap</code></h4>
<p>La fonction <code>getMap()</code> permet d’accéder à une carte stockée dans le <em>package</em>. Ensuite, on applique la fonction <code>fortify()</code>, pour transformer le <code>SpatialPolygonsDataFrame</code> qui a été retourné par la fonction <code>getMap()</code> en tableau de données, afin d’avoir un format lisible par la fonction <code>ggplot()</code>.</p>
<div class="sourceCode" id="cb1204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1204-1"><a href="graphiques.html#cb1204-1" aria-hidden="true"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1204-2"><a href="graphiques.html#cb1204-2" aria-hidden="true"></a><span class="kw">library</span>(rworldmap)</span>
<span id="cb1204-3"><a href="graphiques.html#cb1204-3" aria-hidden="true"></a></span>
<span id="cb1204-4"><a href="graphiques.html#cb1204-4" aria-hidden="true"></a><span class="co"># Carte du monde</span></span>
<span id="cb1204-5"><a href="graphiques.html#cb1204-5" aria-hidden="true"></a>worldMap &lt;-<span class="st"> </span><span class="kw">getMap</span>()</span>
<span id="cb1204-6"><a href="graphiques.html#cb1204-6" aria-hidden="true"></a><span class="co"># Format lisible pour ggplot()</span></span>
<span id="cb1204-7"><a href="graphiques.html#cb1204-7" aria-hidden="true"></a>world_df &lt;-<span class="st"> </span><span class="kw">fortify</span>(worldMap)</span>
<span id="cb1204-8"><a href="graphiques.html#cb1204-8" aria-hidden="true"></a></span>
<span id="cb1204-9"><a href="graphiques.html#cb1204-9" aria-hidden="true"></a><span class="kw">head</span>(world_df)</span></code></pre></div>
<pre><code>##       long      lat order  hole piece          id         group
## 1 61.21082 35.65007     1 FALSE     1 Afghanistan Afghanistan.1
## 2 62.23065 35.27066     2 FALSE     1 Afghanistan Afghanistan.1
## 3 62.98466 35.40404     3 FALSE     1 Afghanistan Afghanistan.1
## 4 63.19354 35.85717     4 FALSE     1 Afghanistan Afghanistan.1
## 5 63.98290 36.00796     5 FALSE     1 Afghanistan Afghanistan.1
## 6 64.54648 36.31207     6 FALSE     1 Afghanistan Afghanistan.1</code></pre>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1206-1"><a href="graphiques.html#cb1206-1" aria-hidden="true"></a>worldmap &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1206-2"><a href="graphiques.html#cb1206-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> world_df, </span>
<span id="cb1206-3"><a href="graphiques.html#cb1206-3" aria-hidden="true"></a>               <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span></span>
<span id="cb1206-4"><a href="graphiques.html#cb1206-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> (<span class="op">-</span><span class="dv">2</span><span class="op">:</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="dv">30</span>) <span class="op">+</span></span>
<span id="cb1206-5"><a href="graphiques.html#cb1206-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> (<span class="op">-</span><span class="dv">4</span><span class="op">:</span><span class="dv">4</span>) <span class="op">*</span><span class="st"> </span><span class="dv">45</span>) <span class="op">+</span></span>
<span id="cb1206-6"><a href="graphiques.html#cb1206-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">coord_equal</span>()</span>
<span id="cb1206-7"><a href="graphiques.html#cb1206-7" aria-hidden="true"></a></span>
<span id="cb1206-8"><a href="graphiques.html#cb1206-8" aria-hidden="true"></a>worldmap</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_maps_recup_rworldmap-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>On peut tout à fait s’amuser avec la fonction <code>coord_map()</code> pour changer le système de coordonnées.</p>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1207-1"><a href="graphiques.html#cb1207-1" aria-hidden="true"></a>worldmap &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1207-2"><a href="graphiques.html#cb1207-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> world_df, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span></span>
<span id="cb1207-3"><a href="graphiques.html#cb1207-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> (<span class="op">-</span><span class="dv">2</span><span class="op">:</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="dv">30</span>) <span class="op">+</span></span>
<span id="cb1207-4"><a href="graphiques.html#cb1207-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> (<span class="op">-</span><span class="dv">4</span><span class="op">:</span><span class="dv">4</span>) <span class="op">*</span><span class="st"> </span><span class="dv">45</span>) <span class="op">+</span></span>
<span id="cb1207-5"><a href="graphiques.html#cb1207-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">coord_map</span>(<span class="st">&quot;ortho&quot;</span>, <span class="dt">orientation=</span><span class="kw">c</span>(<span class="dv">61</span>, <span class="dv">90</span>, <span class="dv">0</span>))</span>
<span id="cb1207-6"><a href="graphiques.html#cb1207-6" aria-hidden="true"></a>worldmap</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_maps_2-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_maps_recup_maps" class="section level4" number="5.4.1.2">
<h4><span class="header-section-number">5.4.1.2</span> <em>Package</em> </h4>
<p>Le <em>package</em> <code>rworldmap</code> est pratique pour obtenir les frontières des pays, mais si on désire obtenir les <code>counties</code> américains, ou les départements français, il est préférable d’aller voir du côté du <em>package</em> {<code>maps</code>}. La fonction <code>map_data()</code> du <em>package</em> {<code>ggplot2</code>} s’appuie sur les cartes du <em>package</em> {<code>maps</code>} pour extraire un tableau de données prêt à être employé avec la fonction <code>ggplot()</code>. Il faut lui fournir le nom de la carte voulu, parmi les noms suivants :</p>
<ul>
<li><code>county</code> : carte des <code>counties</code> américains ;</li>
<li><code>france</code> : carte de la France;</li>
<li><code>italy</code> : carte de l’Italie;</li>
<li><code>nz</code> : carte de la Nouvelle-Zélande;</li>
<li><code>state</code> : carte des états-Unis avec chaque état ;</li>
<li><code>usa</code> : carte des états-Unis avec uniquement les frontières;</li>
<li><code>world</code> : carte du monde ;</li>
<li><code>world2</code> : carte du monde centrée sur le Pacifique.</li>
</ul>
<p>Si on désire extraire uniquement certains sous-régions, il faut préciser leur nom à l’argument <code>region</code>.</p>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1208-1"><a href="graphiques.html#cb1208-1" aria-hidden="true"></a>map_fr &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&quot;france&quot;</span>)</span>
<span id="cb1208-2"><a href="graphiques.html#cb1208-2" aria-hidden="true"></a></span>
<span id="cb1208-3"><a href="graphiques.html#cb1208-3" aria-hidden="true"></a><span class="co"># Le nom des régions</span></span>
<span id="cb1208-4"><a href="graphiques.html#cb1208-4" aria-hidden="true"></a><span class="kw">head</span>(<span class="kw">unique</span>(map_fr<span class="op">$</span>region))</span></code></pre></div>
<pre><code>## [1] &quot;Nord&quot;           &quot;Pas-de-Calais&quot;  &quot;Somme&quot;          &quot;Ardennes&quot;      
## [5] &quot;Seine-Maritime&quot; &quot;Aisne&quot;</code></pre>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1210-1"><a href="graphiques.html#cb1210-1" aria-hidden="true"></a><span class="co"># Carte de la France</span></span>
<span id="cb1210-2"><a href="graphiques.html#cb1210-2" aria-hidden="true"></a>p_map_fr &lt;-<span class="st"> </span></span>
<span id="cb1210-3"><a href="graphiques.html#cb1210-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> map_fr,</span>
<span id="cb1210-4"><a href="graphiques.html#cb1210-4" aria-hidden="true"></a>         <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group, <span class="dt">fill =</span> region)) <span class="op">+</span></span>
<span id="cb1210-5"><a href="graphiques.html#cb1210-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_polygon</span>() <span class="op">+</span><span class="st"> </span><span class="kw">coord_equal</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">guide =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb1210-6"><a href="graphiques.html#cb1210-6" aria-hidden="true"></a></span>
<span id="cb1210-7"><a href="graphiques.html#cb1210-7" aria-hidden="true"></a>p_map_fr</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_maps_recup_maps-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1211-1"><a href="graphiques.html#cb1211-1" aria-hidden="true"></a><span class="co"># Extrayons les données uniquement pour la Bretagne</span></span>
<span id="cb1211-2"><a href="graphiques.html#cb1211-2" aria-hidden="true"></a>ind_bzh &lt;-<span class="st"> </span></span>
<span id="cb1211-3"><a href="graphiques.html#cb1211-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">str_which</span>(<span class="st">&quot;armor|finis|vilaine|morb&quot;</span>,</span>
<span id="cb1211-4"><a href="graphiques.html#cb1211-4" aria-hidden="true"></a>       <span class="dt">pattern =</span> <span class="kw">regex</span>(<span class="kw">unique</span>(map_fr<span class="op">$</span>region), <span class="dt">ignore_case =</span> <span class="ot">TRUE</span>))</span>
<span id="cb1211-5"><a href="graphiques.html#cb1211-5" aria-hidden="true"></a></span>
<span id="cb1211-6"><a href="graphiques.html#cb1211-6" aria-hidden="true"></a><span class="co"># Voici les noms des départements de la Bretagne, tels qu&#39;ils sont</span></span>
<span id="cb1211-7"><a href="graphiques.html#cb1211-7" aria-hidden="true"></a><span class="co"># stockés dans le package maps</span></span>
<span id="cb1211-8"><a href="graphiques.html#cb1211-8" aria-hidden="true"></a>(dep_bzh &lt;-<span class="st"> </span><span class="kw">unique</span>(map_fr<span class="op">$</span>region)[ind_bzh])</span></code></pre></div>
<pre><code>## [1] &quot;Ain&quot;</code></pre>
<div class="sourceCode" id="cb1213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1213-1"><a href="graphiques.html#cb1213-1" aria-hidden="true"></a>map_fr_bzh &lt;-<span class="st"> </span></span>
<span id="cb1213-2"><a href="graphiques.html#cb1213-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">map_data</span>(<span class="st">&quot;france&quot;</span>, <span class="dt">region =</span> dep_bzh) <span class="op">%&gt;%</span></span>
<span id="cb1213-3"><a href="graphiques.html#cb1213-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">as_tibble</span>()</span>
<span id="cb1213-4"><a href="graphiques.html#cb1213-4" aria-hidden="true"></a></span>
<span id="cb1213-5"><a href="graphiques.html#cb1213-5" aria-hidden="true"></a><span class="co"># Carte de la Bretagne</span></span>
<span id="cb1213-6"><a href="graphiques.html#cb1213-6" aria-hidden="true"></a>p_map_fr_bzh &lt;-<span class="st"> </span></span>
<span id="cb1213-7"><a href="graphiques.html#cb1213-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> map_fr_bzh,</span>
<span id="cb1213-8"><a href="graphiques.html#cb1213-8" aria-hidden="true"></a>         <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group, <span class="dt">fill =</span> region)) <span class="op">+</span></span>
<span id="cb1213-9"><a href="graphiques.html#cb1213-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_polygon</span>() <span class="op">+</span><span class="st"> </span><span class="kw">coord_equal</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Département&quot;</span>)</span>
<span id="cb1213-10"><a href="graphiques.html#cb1213-10" aria-hidden="true"></a></span>
<span id="cb1213-11"><a href="graphiques.html#cb1213-11" aria-hidden="true"></a>p_map_fr_bzh</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_maps_recup_maps-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="graphiques_maps_recup_shapefile" class="section level4" number="5.4.1.3">
<h4><span class="header-section-number">5.4.1.3</span> Fichier <em>shapefile</em></h4>
<p>Il est également possible d’importer un fichier <code>shp</code> et de tracer une carte basée sur son contenu. Il est cependant nécessaire de charger quelques <em>packages</em> supplémentaires. Par exemple, pour tracer les quartiers de la ville de Rennes, on peut télécharger et extraire le contenu du fichier <em>shapefile</em> zippé disponible sur le site : <a href="http://www.data.rennes-metropole.fr" class="uri">http://www.data.rennes-metropole.fr</a>. L’importation dans <code>R</code> se fait comme suit, en ayant placé le répertoire <code>"quartiers_shp_lamb93"</code> que l’on vient d’extraire dans le dossier pointé par la fonction <code>getwd()</code>[^pour plus de renseignements, voir ce GitHub : <a href="https://github.com/hadley/ggplot2/wiki/plotting-polygon-shapefiles" class="uri">https://github.com/hadley/ggplot2/wiki/plotting-polygon-shapefiles</a>].</p>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1214-1"><a href="graphiques.html#cb1214-1" aria-hidden="true"></a><span class="kw">library</span>(<span class="st">&quot;rgdal&quot;</span>)</span>
<span id="cb1214-2"><a href="graphiques.html#cb1214-2" aria-hidden="true"></a><span class="kw">library</span>(<span class="st">&quot;maptools&quot;</span>)</span>
<span id="cb1214-3"><a href="graphiques.html#cb1214-3" aria-hidden="true"></a><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb1214-4"><a href="graphiques.html#cb1214-4" aria-hidden="true"></a><span class="kw">library</span>(<span class="st">&quot;plyr&quot;</span>)</span>
<span id="cb1214-5"><a href="graphiques.html#cb1214-5" aria-hidden="true"></a></span>
<span id="cb1214-6"><a href="graphiques.html#cb1214-6" aria-hidden="true"></a><span class="co"># Importer les polygones</span></span>
<span id="cb1214-7"><a href="graphiques.html#cb1214-7" aria-hidden="true"></a>rennes &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn=</span><span class="st">&quot;./quartiers_shp_lamb93&quot;</span>, <span class="dt">layer=</span><span class="st">&quot;quartiers&quot;</span>)</span>
<span id="cb1214-8"><a href="graphiques.html#cb1214-8" aria-hidden="true"></a></span>
<span id="cb1214-9"><a href="graphiques.html#cb1214-9" aria-hidden="true"></a><span class="co"># Étape pour changer la projection de la carte</span></span>
<span id="cb1214-10"><a href="graphiques.html#cb1214-10" aria-hidden="true"></a>rennes &lt;-<span class="st"> </span><span class="kw">spTransform</span>(rennes, <span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=GRS80&quot;</span>))</span>
<span id="cb1214-11"><a href="graphiques.html#cb1214-11" aria-hidden="true"></a></span>
<span id="cb1214-12"><a href="graphiques.html#cb1214-12" aria-hidden="true"></a><span class="co"># Pour permettre la jointure des objets géométriques</span></span>
<span id="cb1214-13"><a href="graphiques.html#cb1214-13" aria-hidden="true"></a>rennes<span class="op">@</span>data<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw">rownames</span>(rennes<span class="op">@</span>data)</span>
<span id="cb1214-14"><a href="graphiques.html#cb1214-14" aria-hidden="true"></a></span>
<span id="cb1214-15"><a href="graphiques.html#cb1214-15" aria-hidden="true"></a><span class="co"># Transformer en data frame pour fournir à ggplot()</span></span>
<span id="cb1214-16"><a href="graphiques.html#cb1214-16" aria-hidden="true"></a>rennes_points &lt;-<span class="st"> </span><span class="kw">fortify</span>(rennes, <span class="dt">region=</span><span class="st">&quot;id&quot;</span>)</span>
<span id="cb1214-17"><a href="graphiques.html#cb1214-17" aria-hidden="true"></a></span>
<span id="cb1214-18"><a href="graphiques.html#cb1214-18" aria-hidden="true"></a><span class="co"># Permet d&#39;éviter des trous éventuels</span></span>
<span id="cb1214-19"><a href="graphiques.html#cb1214-19" aria-hidden="true"></a>rennes_df &lt;-<span class="st"> </span><span class="kw">join</span>(rennes_points, rennes<span class="op">@</span>data, <span class="dt">by=</span><span class="st">&quot;id&quot;</span>)</span></code></pre></div>
<p>Il ne reste plus qu’à tracer la carte.</p>
<div class="sourceCode" id="cb1215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1215-1"><a href="graphiques.html#cb1215-1" aria-hidden="true"></a>p_map_rennes &lt;-<span class="st"> </span></span>
<span id="cb1215-2"><a href="graphiques.html#cb1215-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> rennes_df,</span>
<span id="cb1215-3"><a href="graphiques.html#cb1215-3" aria-hidden="true"></a>         <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span></span>
<span id="cb1215-4"><a href="graphiques.html#cb1215-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_polygon</span>() <span class="op">+</span></span>
<span id="cb1215-5"><a href="graphiques.html#cb1215-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">coord_equal</span>()</span>
<span id="cb1215-6"><a href="graphiques.html#cb1215-6" aria-hidden="true"></a></span>
<span id="cb1215-7"><a href="graphiques.html#cb1215-7" aria-hidden="true"></a>p_map_rennes</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_maps_recup_shapefile_2-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="graphiques_maps_choroplethe" class="section level3" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Carte choroplèthe</h3>
<p>Pour réaliser une carte choroplète, c’est-à-dire une carte où les régions sont remplies par une couleur en fonction d’une statistique, il suffit juste d’ajouter une colonne avec la valeur de la statistique dans le tableau de données permettant de dessiner la carte. Appuyons-nous sur la carte de la Bretagne définie en Section @ref(graphiques_maps_recup_maps).</p>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1216-1"><a href="graphiques.html#cb1216-1" aria-hidden="true"></a>tx_chomage_<span class="dv">2014</span>_T1 &lt;-<span class="st"> </span></span>
<span id="cb1216-2"><a href="graphiques.html#cb1216-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">tibble</span>(</span>
<span id="cb1216-3"><a href="graphiques.html#cb1216-3" aria-hidden="true"></a>  <span class="dt">region =</span> <span class="kw">c</span>(<span class="st">&quot;Cotes-Darmor&quot;</span>,<span class="st">&quot;Finistere&quot;</span>,</span>
<span id="cb1216-4"><a href="graphiques.html#cb1216-4" aria-hidden="true"></a>             <span class="st">&quot;Ille-et-Vilaine&quot;</span>, <span class="st">&quot;Morbihan&quot;</span>),</span>
<span id="cb1216-5"><a href="graphiques.html#cb1216-5" aria-hidden="true"></a>  <span class="dt">tx_chomage_2014_T1 =</span> <span class="kw">c</span>(<span class="fl">8.8</span>, <span class="fl">8.8</span>,<span class="fl">7.9</span>, <span class="fl">9.1</span>))</span>
<span id="cb1216-6"><a href="graphiques.html#cb1216-6" aria-hidden="true"></a></span>
<span id="cb1216-7"><a href="graphiques.html#cb1216-7" aria-hidden="true"></a><span class="co"># Ajout des valeurs pour chaque région</span></span>
<span id="cb1216-8"><a href="graphiques.html#cb1216-8" aria-hidden="true"></a>map_fr_bzh &lt;-<span class="st"> </span></span>
<span id="cb1216-9"><a href="graphiques.html#cb1216-9" aria-hidden="true"></a><span class="st">  </span>map_fr_bzh <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1216-10"><a href="graphiques.html#cb1216-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">left_join</span>(</span>
<span id="cb1216-11"><a href="graphiques.html#cb1216-11" aria-hidden="true"></a>    tx_chomage_<span class="dv">2014</span>_T1</span>
<span id="cb1216-12"><a href="graphiques.html#cb1216-12" aria-hidden="true"></a>  )</span>
<span id="cb1216-13"><a href="graphiques.html#cb1216-13" aria-hidden="true"></a></span>
<span id="cb1216-14"><a href="graphiques.html#cb1216-14" aria-hidden="true"></a></span>
<span id="cb1216-15"><a href="graphiques.html#cb1216-15" aria-hidden="true"></a><span class="co"># Il suffit de faire dépendre le remplissage de tx_chomage_2014_T1</span></span>
<span id="cb1216-16"><a href="graphiques.html#cb1216-16" aria-hidden="true"></a>p_map_fr_bzh &lt;-<span class="st"> </span></span>
<span id="cb1216-17"><a href="graphiques.html#cb1216-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> map_fr_bzh) <span class="op">+</span></span>
<span id="cb1216-18"><a href="graphiques.html#cb1216-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group,</span>
<span id="cb1216-19"><a href="graphiques.html#cb1216-19" aria-hidden="true"></a>             <span class="dt">fill =</span> tx_chomage_<span class="dv">2014</span>_T1)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1216-20"><a href="graphiques.html#cb1216-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1216-21"><a href="graphiques.html#cb1216-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">name =</span> <span class="st">&quot;Département&quot;</span>, <span class="dt">low =</span><span class="st">&quot;#FFFF00&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;#FF0000&quot;</span>)</span>
<span id="cb1216-22"><a href="graphiques.html#cb1216-22" aria-hidden="true"></a></span>
<span id="cb1216-23"><a href="graphiques.html#cb1216-23" aria-hidden="true"></a>p_map_fr_bzh</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_maps_choroplethe-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1217-1"><a href="graphiques.html#cb1217-1" aria-hidden="true"></a><span class="co"># Fonction pour trouver le point central du polygone</span></span>
<span id="cb1217-2"><a href="graphiques.html#cb1217-2" aria-hidden="true"></a>mid_range &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">mean</span>(<span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb1217-3"><a href="graphiques.html#cb1217-3" aria-hidden="true"></a></span>
<span id="cb1217-4"><a href="graphiques.html#cb1217-4" aria-hidden="true"></a>centres &lt;-<span class="st"> </span></span>
<span id="cb1217-5"><a href="graphiques.html#cb1217-5" aria-hidden="true"></a><span class="st">  </span>map_fr_bzh <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1217-6"><a href="graphiques.html#cb1217-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1217-7"><a href="graphiques.html#cb1217-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">lat =</span> <span class="kw">mid_range</span>(lat),</span>
<span id="cb1217-8"><a href="graphiques.html#cb1217-8" aria-hidden="true"></a>            <span class="dt">long =</span> <span class="kw">mid_range</span>(long))</span>
<span id="cb1217-9"><a href="graphiques.html#cb1217-9" aria-hidden="true"></a></span>
<span id="cb1217-10"><a href="graphiques.html#cb1217-10" aria-hidden="true"></a></span>
<span id="cb1217-11"><a href="graphiques.html#cb1217-11" aria-hidden="true"></a><span class="co"># Rajout des taux de chômage</span></span>
<span id="cb1217-12"><a href="graphiques.html#cb1217-12" aria-hidden="true"></a>centres &lt;-<span class="st"> </span></span>
<span id="cb1217-13"><a href="graphiques.html#cb1217-13" aria-hidden="true"></a><span class="st">  </span>centres <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1217-14"><a href="graphiques.html#cb1217-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">left_join</span>(tx_chomage_<span class="dv">2014</span>_T1) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1217-15"><a href="graphiques.html#cb1217-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label_chomage =</span> <span class="kw">str_c</span>(tx_chomage_<span class="dv">2014</span>_T1, <span class="st">&quot;%&quot;</span>))</span>
<span id="cb1217-16"><a href="graphiques.html#cb1217-16" aria-hidden="true"></a></span>
<span id="cb1217-17"><a href="graphiques.html#cb1217-17" aria-hidden="true"></a>p_map_fr_bzh <span class="op">+</span><span class="st"> </span></span>
<span id="cb1217-18"><a href="graphiques.html#cb1217-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_label</span>(<span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">label =</span> label_chomage),</span>
<span id="cb1217-19"><a href="graphiques.html#cb1217-19" aria-hidden="true"></a>             <span class="dt">data =</span> centres)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_maps_choroplethe_2-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="graphiques_3d" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Graphiques en 3D</h2>
<p>Le <em>package</em> {<code>ggplot2</code>} ne permet malheureusement pas (encore) de réaliser des graphiques en 3D. Il faut aller regarder du côté des <em>packages</em> {<code>base</code>}, {<code>lattice</code>} ou encore {<code>rgl</code>} pour cela. Le lecteur ou la lectrice intéressé•e par ces options offertes par <code>R</code> est invité•e à consulter les pages d’aide des fonctions, à parcourir les vignettes et les démos.</p>
<div class="sourceCode" id="cb1218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1218-1"><a href="graphiques.html#cb1218-1" aria-hidden="true"></a><span class="kw">library</span>(MASS)</span>
<span id="cb1218-2"><a href="graphiques.html#cb1218-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb1218-3"><a href="graphiques.html#cb1218-3" aria-hidden="true"></a><span class="co"># Normale bivariée</span></span>
<span id="cb1218-4"><a href="graphiques.html#cb1218-4" aria-hidden="true"></a>Sigma &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>),<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb1218-5"><a href="graphiques.html#cb1218-5" aria-hidden="true"></a>biv_n &lt;-<span class="st"> </span><span class="kw">mvrnorm</span>(<span class="dt">n=</span><span class="dv">1000</span>, <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>), Sigma)</span>
<span id="cb1218-6"><a href="graphiques.html#cb1218-6" aria-hidden="true"></a></span>
<span id="cb1218-7"><a href="graphiques.html#cb1218-7" aria-hidden="true"></a><span class="co"># Estimation par la méthode du noyau de la densité</span></span>
<span id="cb1218-8"><a href="graphiques.html#cb1218-8" aria-hidden="true"></a>biv_n_kde &lt;-<span class="st"> </span><span class="kw">kde2d</span>(biv_n[,<span class="dv">1</span>], biv_n[,<span class="dv">2</span>], <span class="dt">n =</span> <span class="dv">50</span>)</span>
<span id="cb1218-9"><a href="graphiques.html#cb1218-9" aria-hidden="true"></a></span>
<span id="cb1218-10"><a href="graphiques.html#cb1218-10" aria-hidden="true"></a><span class="kw">persp</span>(biv_n_kde, <span class="dt">theta =</span> <span class="dv">10</span>, <span class="dt">phi =</span> <span class="dv">15</span>, <span class="dt">xlab =</span> <span class="st">&quot;X&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graphiques_3d_persp-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Une autre fonction, peut-être plus pratique pour visualiser des graphiques en 3d, puisqu’on peut se servir de la souris pour changer d’angle, est <code>plot3d()</code>, du <em>package</em> {<code>rgl</code>}.</p>
<div class="sourceCode" id="cb1219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1219-1"><a href="graphiques.html#cb1219-1" aria-hidden="true"></a><span class="kw">library</span>(rgl)</span>
<span id="cb1219-2"><a href="graphiques.html#cb1219-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb1219-3"><a href="graphiques.html#cb1219-3" aria-hidden="true"></a>n &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb1219-4"><a href="graphiques.html#cb1219-4" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">38</span>)</span>
<span id="cb1219-5"><a href="graphiques.html#cb1219-5" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">42</span>)</span>
<span id="cb1219-6"><a href="graphiques.html#cb1219-6" aria-hidden="true"></a></span>
<span id="cb1219-7"><a href="graphiques.html#cb1219-7" aria-hidden="true"></a>biv_kde &lt;-<span class="st"> </span><span class="kw">kde2d</span>(x, y, <span class="dt">n =</span> <span class="dv">50</span>)</span>
<span id="cb1219-8"><a href="graphiques.html#cb1219-8" aria-hidden="true"></a>den_z &lt;-<span class="st"> </span>biv_kde<span class="op">$</span>z</span>
<span id="cb1219-9"><a href="graphiques.html#cb1219-9" aria-hidden="true"></a></span>
<span id="cb1219-10"><a href="graphiques.html#cb1219-10" aria-hidden="true"></a><span class="kw">surface3d</span>(biv_kde<span class="op">$</span>x,biv_kde<span class="op">$</span>y,den_z<span class="op">*</span><span class="dv">20</span>,<span class="dt">color=</span><span class="st">&quot;#FF2222&quot;</span>,<span class="dt">alpha=</span><span class="fl">0.5</span>)</span></code></pre></div>
<p>Pour les personnes intéressées, l’exécution des lignes ci-après donne un aperçu plus large de ce qu’il est possible de faire avec le <em>package</em> {<code>rgl</code>}.</p>
<div class="sourceCode" id="cb1220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1220-1"><a href="graphiques.html#cb1220-1" aria-hidden="true"></a><span class="kw">demo</span>(rgl)</span>
<span id="cb1220-2"><a href="graphiques.html#cb1220-2" aria-hidden="true"></a><span class="kw">example</span>(rgl)</span></code></pre></div>
</div>
<div id="graphiques_exercices" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> Exercices</h2>
<!-- % ======== % -->
<!-- % EXERCICE % -->
<!-- % ======== % -->

<div class="exframe">
<p><strong>Exercice 1 : créer un graphique simple, modifier son aspect</strong>
1. Charger le <em>package</em> {<code>ggplot2</code>}, et utiliser la fonction <code>data()</code> pour charger en mémoire le jeu de données <code>economics</code>. Consulter la page d’aide de ce jeu de données pour prendre connaissance de son contenu ;
2. À l’aide de la fonction <code>ggplot()</code>, représenter les dépenses personnelles de consommation (<code>pce</code>) en fonction de la date (<code>date</code>). Les observations doivent être connectées par une ligne.
3. Modifier le graphique de la question précédente de manière à ce que la couleur de la ligne soit <code>dodger blue</code> et définir la taille de la ligne à <code>0.5</code>. Stocker le résultat dans un objet que l’on appellera <code>p_1</code> ;
4. Ajouter une couche au graphique <code>p_1</code> pour modifier les titres des axes (les retirer), et définir le titre suivant : “Personal Consumption Expenditures (billions dollars)”.
5. Utiliser la fonction <code>date_breaks()</code> du <em>package</em> {<code>scales</code>} pour modifier l’échelle des abscisses de <code>p_1</code>, afin que les étiquettes des marques soient affichées tous les 5 ans ; à l’aide de la fonction <code>date_format()</code>, modifier le format de ces étiquettes pour que seule l’année des dates s’affiche.</p>
</div>
<!-- % ======== % -->
<!-- % EXERCICE % -->
<!-- % ======== % -->

<div class="exframe">
<p><strong>Exercice 2 : créer un graphique avec plusieurs courbes, modifier son aspect</strong></p>
<ol style="list-style-type: decimal">
<li><p>Charger le <em>package</em> {<code>ggplot2</code>}, et utiliser la fonction <code>data()</code> pour charger en mémoire le jeu de données . Consulter la page d’aide de ce jeu de données pour prendre connaissance de son contenu ;</p></li>
<li><p>Charger le <em>package</em> {<code>}tidyverse</code>}. Sélectionner les variables <code>date</code>, <code>psavert</code> et <code>uempmed</code> dans le tableau de données <code>economics</code> et utiliser la fonction <code>pivot_longer()</code> sur le résultat pour obtenir un tableau dans lequel chaque ligne indiquera la valeur (<code>value</code>) pour une variable donnée (<code>key</code>) à une date donnée (<code>date</code>). Stocker le résultat dans un objet que l’on appellera <code>df</code> ;</p></li>
<li><p>Sur un même graphique, représenter à l’aide de lignes, l’évolution dans le temps du taux d’épargne personnelle (<code>psavert</code>) et de la durée médiane en semaines du chômage (<code>uempmed</code>). Stocker le graphique dans un objet que l’on appellera <code>p_2</code> ;</p></li>
<li><p>Modifier le code ayant servi à construire le graphique <code>p_2</code> pour que le type de ligne soit différent pour chacune des deux séries représentées. Les deux lignes doivent être tracées en bleu. Stocker le graphique dans un objet que l’on appellera <code>p_3</code> ;</p></li>
<li><p>À présent, modifier le code ayant servi à construire <code>p_3</code> pour qu’à la fois la couleur et le type de ligne servent à différencier les deux séries. Stocker le graphique dans un objet que l’on appellera <code>p_4</code> ;</p></li>
<li><p>Modifier le graphique <code>p_4</code> en ajoutant une couche d’échelle de couleur pour que le taux d’épargne personnelle (<code>psavert</code>) soit représenté en <code>dodger blue</code>, et que la durée de chômage (<code>uempmed</code>) soit représentée en rouge. Par ailleurs, retirer le titre de la légende ;</p></li>
<li><p>Modifier le graphique <code>p_4</code> en ajoutant une couche d’échelle de type de ligne pour que le taux d’épargne personnelle (<code>psavert</code>) soit représenté par des tirets, et que la durée de chômage (<code>uempmed</code>) soit représentée par une ligne pleine. Par ailleurs, retirer le titre de la légende des types de lignes, afin que les légendes de couleur et de type de ligne soient fusionnées ;</p></li>
<li><p>Créer le tableaux de données <code>df_2</code>, une copie de <code>df</code>, dans lequel la variable <code>key</code> doit être un facteur dont les niveaux sont <code>uempmed</code> et <code>psavert</code> ;</p></li>
<li><p>Créer le vecteur  suivant :</p>
<p><code>etiq &lt;- c("psavert" = "Pers. Saving Rate",</code>
<code>"uempmed" = "Median Duration of Unemployment (weeks)")</code></p>
<p>Ce vecteur contient des valeurs d’étiquettes pour la légende du graphique qu’il va falloir créer.</p>
<p>Représenter sur un même graphique lévolution dans le temps du taux d’épargne personnelle et de la durée médiane du chômage en semaines, en s’appuyant sur les données contenues dans le tableau <code>df_2</code>. La courbe du taux d’épargne personnelle doit être composée de tirets et être de couleur <code>dodger blue</code> ; la courbe de la durée médiane du taux de chômage doit être une ligne rouge. La légende ne doit pas comporter de titre, et ses étiquettes doivent être modifiées pour que “Pers. Saving Rate” s’affiche à la place de “psavert”, et pour que “Median Duration of Unemployment (weeks)” s’affiche à la place de “uempmed”. Stocker le graphique dans un objet que l’on appellera <code>p_5</code> ;</p>
<p><em>Note : il s’agit de reprendre le code ayant servi à créer le graphique <code>p_4</code>, en modifiant légèrement les échelles de couleur et de ligne pour prendre en compte les étiquettes proposées dans le vecteur <code>etiq</code>.</em></p></li>
<li><p>Modifier <code>p_5</code> pour lui ajouter une couche permettant de déplacer la légende en bas du graphique (utiliser la fonction <code>theme()</code>) ;</p></li>
<li><p>Ajouter une couche au graphique <code>p_5</code> qui permet de définir un thème. Utiliser le thème minimal (`theme_minimal()). Que se passe-t-il pour la légende ? Repositionner la légende en dessous, et retirer les titres des axes ;</p></li>
<li><p>Sauvegarder le graphique <code>p_5</code> au format PDF en précisant une largeur de 12 et une hauteur de 8.</p></li>
</ol>
</div>
<!-- % ======== % -->
<!-- % EXERCICE % -->
<!-- % ======== % -->

<div class="exframe">
<p><strong>Exercice 3 : différentes représentations graphiques</strong></p>
<ol style="list-style-type: decimal">
<li><p>Charger le jeu de données <code>mpg</code> contenu dans le <em>package</em> {<code>ggplot2</code>} en mémoire, puis consulter la page d’aide du jeu de données pour en prendre connaissance ;</p></li>
<li><p>Représenter à l’aide d’un nuage de points la relation entre la consommation sur autoroute des véhicules de l’échantillon (<code>hwy</code>) et la cylindrée de leur moteur (<code>displ</code>)</p></li>
<li><p>Reprendre le code du graphique précédent et modifier la forme des points pour les changer en symbole <code>+</code> ; modifier la couleur des <code>+</code> de manière à la faire dépendre du nombre de cylindres (<code>cyl</code>) ;</p></li>
<li><p>À présent, représenter par des boîtes à moustaches la distribution de la consommation sur autoroute des véhicules (<code>hwy</code>) pour chacune des valeurs possibles du nombre de cylindres (<code>cyl</code>) ;</p></li>
<li><p>Charger le jeu de données <code>economics</code> contenu dans le <em>package</em> {<code>ggplot2</code>} en mémoire, puis consulter la page d’aide du jeu de données pour en prendre connaissance. Ensuite, ajouter au tableau (les créer) les variables <code>u_rate</code> et <code>e_rate</code>, respectivement le taux de chômage et le taux d’emploi (on définira le taux de chômage de manière très grossière ici : nombre de personnes non employées sur la population totale) ;</p></li>
<li><p>Représenter à l’aide de barres l’évolution dans le temps du taux de chômage, et remplir les barres avec la couleur rouge ;</p></li>
<li><p>Reprendre le code du graphique précédent et ajouter une couche permettant de modifier les limites de l’axe des abscisses pour afficher les valeurs uniquement sur la période “2012-01-01” à “2015-01-01” (utiliser la fonction <code>coord_cartesian()</code>). Stocker le graphique dans un objet que l’on appellera <code>p</code> ;</p></li>
<li><p>Dans le tableau de données <code>economics</code>, sélectionner les variables <code>date</code>, <code>u_rate</code> et <code>e_rate</code>, puis utiliser la fonction <code>pivot_longer()</code> pour obtenir un tableau dans lequel chaque ligne correspond à la valeur d’une des variables (taux de chômage ou taux d’emploi) à une date donnée. Stocker le résultat dans un objet que l’on appellera <code>df_3</code> ;</p></li>
<li><p>Utiliser le tableau de données <code>df_3</code> pour représenter graphiquement à l’aide de barres les taux de chômage et taux d’emploi par mois sur la période “2012-01-01” à “2015-01-01”. Sur le graphique, les barres représentant le taux de chômage et celles représentant le taux d’emploi devront être superposées.</p>
<p><em>Note : il s’agit de modifier légèrement le code ayant permis de réaliser le graphique <code>p</code>.</em></p></li>
</ol>
</div>
<!-- % ======== % -->
<!-- % EXERCICE % -->
<!-- % ======== % -->

<div class="exframe">
<p><strong>Exercice 4 : facettes</strong></p>
<ol style="list-style-type: decimal">
<li><p>Charger le <em>package</em> {<code>WDI</code>} (l’installer si nécessaire), puis en utilisant la fonction <code>WDI()</code>, récupérer les données de PIB par tête (<code>NY.GDP.PCAP.PP.KD</code>, PPP, constant 2005 international $) et de taux de chômage (<code>SL.UEM.TOTL.ZS</code>, total, % of total labor force) pour la France, l’Allemagne et le Royaume Uni, pour la période allant de 1990 à 2015. Ces données doivent être stockées dans un tableau que l’on appellera <code>df</code> ;</p></li>
<li><p>Transformer le tableau <code>df</code> afin que chaque ligne indique : l’état (<code>country</code>), l’année (<code>year</code>), le nom de la variable (<code>variable</code>) et la valeur (<code>valeur</code>) (utiliser la fonction <code>pivot_longer()</code>). Puis, modifier la colonne <code>variable</code> afin qu’elle soit de type <code>factor</code>, et que les étiquettes des niveaux <code>NY.GDP.PCAP.PP.KD</code> et  deviennent <code>GDP</code> et <code>Unemployment</code> respectivement ;</p></li>
<li><p>Représenter graphiquement l’évolution du PIB et du taux de chômage pour les trois pays. Utiliser la fonction <code>facet_wrap()</code> afin de regrouper les variables par type : les observations des valeurs du PIB d’un côté du “tableau” de graphiques, et celles du taux de chômage de l’autre. Utiliser une représentation en ligne, en faisant dépendre la couleur du pays ;</p></li>
<li><p>Reprendre le code du graphique précédent en le modifiant légèrement afin de libérer les axes des ordonnées ;</p></li>
<li><p>Modifier les arguments esthétiques du graphique afin de faire dépendre le type de ligne des pays de la manière suivante : des points pour la France, des tirets pour l’Allemagne, des tirets longs pour le Royaume Uni. Définir l’épaisseur des lignes à <span class="math inline">\(1.5\)</span> ;</p></li>
<li><p>Modifier légèrement le code ayant permis de réaliser le graphique de la question précédente pour que la direction ne soit non plus horizontale (par défaut), mais verticale (argument <code>dir</code>, ou à défaut, <code>ncol</code> dans ce cas précis) ;</p></li>
<li><p>En utilisant la fonction <code>facet_wrap()</code>, créer une grille de graphiques, de sorte que chaque pannel représente l’évolution d’une seule série pour un pays donné ;</p></li>
<li><p>À présent, utiliser la fonction <code>facet_grid()</code> pour créer une grille de graphiques dans laquelle les lignes correspondent aux pays et les colonnes aux variables. Prendre soin de libérer les échelles ;</p></li>
<li><p>Reprendre la question précédente en faisant cette fois une girlle dans laquelle les lignes correspondent aux variables et les colonnes aux pays.</p></li>
</ol>
</div>
<!-- % ======== % -->
<!-- % EXERCICE % -->
<!-- % ======== % -->

<div class="exframe">
<p><strong>Exercice 5 : annotations</strong></p>
<ol style="list-style-type: decimal">
<li><p>En utilisant la fonction <code>WDI()</code> du <em>package</em> <code>WDI</code>, récupérer les séries de 2010 du PIB par tête (<code>NY.GDP.PCAP.PP.KD</code>, PPP, constant 2005 international $) et de l’espérance de vie à la naissance (<code>SP.DYN.LE00.IN</code>, total, years) pour tous les pays. Les données seront stockées dans un tableau que l’on nommera <code>df</code> ;</p></li>
<li><p>Représenter par un nuage de points l’espérance de vie à la naissance en fonction du PIB par tête. Retirer les titres des axes, et ajouter le titre suivant (sur deux lignes) : “Life Expectancy at birth (years) VS Real GDP per Capita (PPP, contant 2005 international $” ;</p></li>
<li><p>Ajouter une courbe de tendance obtenue par lissage Loess (en utilisant une fonction du <em>package</em> {<code>ggplot2</code>}) ;</p></li>
<li><p>Modifier le tableau <code>df</code> pour lui ajouter la variable <code>drapeau</code> qui prendra la valeur <code>TRUE</code> si l’état de l’observation est soit <code>France</code>, soit <code>Luxembourg</code>, et <code>FAUX</code> sinon ;</p></li>
<li><p>Modifier légèrement le code ayant permis de réaliser le précédent graphique, pour faire dépendre la couleur des points de la variable drapeau (rouge pour <code>TRUE</code> et noir pour <code>FALSE</code>) ;</p></li>
<li><p>Créer un tableau de données que l’on appellera <code>df_fleche</code> qui contient les observations du tableau <code>df</code> pour la France et le Luxembourg uniquement ;</p></li>
<li><p>Reprendre le code du graphique précédent pour le modifier de façon à ajouter deux flèches : l’une montrant le points de la France et l’autre du Luxembourg. Le nom du pays devra être inscrit à l’origine des deux flèches (utiliser la fonction <code>annotate()</code> et se servir du tableau de données <code>df_fleche</code>).</p></li>
</ol>
</div>
<!-- % ======== % -->
<!-- % EXERCICE % -->
<!-- % ======== % -->

<div class="exframe">
<p><strong>Exercice 6 : annotations</strong></p>
<ol style="list-style-type: decimal">
<li><p>À l’aide de la fonction <code>WDI</code> du <em>package</em> {<code>WDI</code>}, récupérer la série de l’inflation (<code>FP.CPI.TOTL.ZG</code>, consumer prices, annual %) en France sur la période 1960–2015, et stocker ces données dans un tableau que l’on appellera <code>inflation_fr</code> ;</p></li>
<li><p>Représenter par une ligne l’évolution du taux annuel d’inflation en France sur la période 1960–2015. Retirer les titres d’axes et ajouter le titre suivant : “Inflation in France (annual %)” ;</p></li>
<li><p>Soient les deux vecteurs suivants, qui définissent les dates de début et fin de la période inflationniste et celle de grande modération :</p></li>
</ol>
</div>
<div class="sourceCode" id="cb1221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1221-1"><a href="graphiques.html#cb1221-1" aria-hidden="true"></a>per_<span class="dv">1</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1970</span>, <span class="dv">1976</span>) <span class="co"># Periode inflationniste</span></span>
<span id="cb1221-2"><a href="graphiques.html#cb1221-2" aria-hidden="true"></a>per_<span class="dv">2</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1976</span>, <span class="dv">1991</span>) <span class="co"># Periode de grande moderation</span></span></code></pre></div>

<div class="exframe">
<ol start="3" style="list-style-type: decimal">
<li><p>Reprendre le code du graphique précédent et ajouter deux rectangles : un premier, rouge, pour mettre en valeur la période inflationniste et un second, bleu, mettant en valeur la période de grande modération. Modifier l’argument de transparence pour le fixer à 0.2 ;</p></li>
<li><p>Ajouter au graphique précédent des lignes grises verticales en tirets pour les années 1973, 1979 et 2008. Modifier également les <code>breaks</code> de l’échelle des abscisses à l’aide de la fonction <code>pretty_breaks()</code> du <em>package</em> scales.</p></li>
</ol>
</div>
<!-- % ======== % -->
<!-- % EXERCICE % -->
<!-- % ======== % -->

<div class="exframe">
<p><strong>Exercice 7 : carte simple</strong></p>
<ol style="list-style-type: decimal">
<li><p>À l’aide de la fonction <code>WDI()</code> du <em>package</em> {<code>WDI</code>}, récupérer la série fournie par la Banque Mondiale du PIB par tête (<code>NY.GDP.PCAP.PP.KD</code>, PPP, constant 2005 international $) pour tous les pays disponibles pour l’année 2010, et stocker ces données dans un tableau que l’on appellera <code>gdp_capita</code> ;</p></li>
<li><p>Dans le tableau <code>gdp_capita</code>, modifier la valeur de la variable <code>country</code> pour l’observation de la Slovaquie, pour qu’elle vaille <code>Slovakia</code> au lieu de <code>Slovak Republic</code> ;</p></li>
<li><p>Filtrer les observations du tableau <code>gdp_capita</code> pour ne conserver que les observations des pays membres de l’Union Européenne dont les noms sont contenus dans le vecteur <code>membres_ue</code>. Stocker le résultat dans un tableau que l’on nommera <code>gdp_capita_eu</code> ;</p></li>
</ol>
</div>
<div class="sourceCode" id="cb1222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1222-1"><a href="graphiques.html#cb1222-1" aria-hidden="true"></a>membres_ue &lt;-<span class="kw">c</span>(<span class="st">&quot;Austria&quot;</span>, <span class="st">&quot;Belgium&quot;</span>, <span class="st">&quot;Bulgaria&quot;</span>, <span class="st">&quot;Cyprus&quot;</span>, <span class="st">&quot;Croatia&quot;</span>,</span>
<span id="cb1222-2"><a href="graphiques.html#cb1222-2" aria-hidden="true"></a>              <span class="st">&quot;Czech Republic&quot;</span>, <span class="st">&quot;Denmark&quot;</span>, <span class="st">&quot;Estonia&quot;</span>, <span class="st">&quot;Finland&quot;</span>, <span class="st">&quot;France&quot;</span>,</span>
<span id="cb1222-3"><a href="graphiques.html#cb1222-3" aria-hidden="true"></a>              <span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;Greece&quot;</span>, <span class="st">&quot;Hungary&quot;</span>, <span class="st">&quot;Ireland&quot;</span>, <span class="st">&quot;Italy&quot;</span>, <span class="st">&quot;Latvia&quot;</span>,</span>
<span id="cb1222-4"><a href="graphiques.html#cb1222-4" aria-hidden="true"></a>              <span class="st">&quot;Lithuania&quot;</span>, <span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Malta&quot;</span>, <span class="st">&quot;Netherlands&quot;</span>, <span class="st">&quot;Poland&quot;</span>,</span>
<span id="cb1222-5"><a href="graphiques.html#cb1222-5" aria-hidden="true"></a>              <span class="st">&quot;Portugal&quot;</span>, <span class="st">&quot;Romania&quot;</span>, <span class="st">&quot;Slovakia&quot;</span>, <span class="st">&quot;Slovenia&quot;</span>, <span class="st">&quot;Spain&quot;</span>,</span>
<span id="cb1222-6"><a href="graphiques.html#cb1222-6" aria-hidden="true"></a>              <span class="st">&quot;Sweden&quot;</span>, <span class="st">&quot;United Kingdom&quot;</span>)</span></code></pre></div>

<div class="exframe">
<ol start="4" style="list-style-type: decimal">
<li><p>Utiliser le <em>package</em> {<code>rworldmap</code>} pour récupérer les données nécessaires à la réalisation d’une carte du monde ;</p></li>
<li><p>Afficher une carte du monde à l’aide des fonctions contenues dans le <em>package</em> {<code>ggplot2</code>} ;</p></li>
<li><p>Modifier les échelles des axes pour faire figurer les méridiens de <span class="math inline">\(-60\)</span> à <span class="math inline">\(60\)</span> par pas de 30 et les parallèles de <span class="math inline">\(-180\)</span> à <span class="math inline">\(180\)</span> par pas de 45. Modifier également la projection cartographique pour choisir la projection orthographique, à l’aide de la fonction <code>coord_map()</code> ;</p></li>
<li><p>Joindre les informations contenues dans le tableau <code>gdp_capita_eu</code> au tableau contenant les données permettant la réalisation des cartes ;</p></li>
<li><p>Réaliser une carte choroplèthe reflétant pour chaque pays membre de l’Union Européenne la valeur du PIB par tête de 2012 ;</p></li>
<li><p>Modifier les couleurs de l’échelle continue de la carte précédente, pour que les faibles valeurs du PIB par tête soient représentées en jaune, et les valeurs les plus hautes en rouge ;</p></li>
<li><p>Modifier les ruptures de l’échelle de couleur pour qu’elles aillent de <span class="math inline">\(10000\)</span> à <span class="math inline">\(100000\)</span> ; modifier également l’étiquette de ces ruptures de sorte que <span class="math inline">\(35000\)</span> soit affiché comme <span class="math inline">\(35\)</span>k, <span class="math inline">\(60000\)</span> comme <span class="math inline">\(60\)</span>k, etc. Enfin, ajouter un titre au graphique et retirer les titres d’axes.</p></li>
</ol>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Bivand_2008_Applied">
<p>Bivand, Roger S, Edzer J Pebesma, and Virgilio Gómez-Rubio. n.d. <em>Applied Spatial Data Analysis with R</em>. Vol. 747248717. Springer.</p>
</div>
<div id="ref-Chang_2013_R">
<p>Chang, W. 2013. <em><code>R</code> Graphics Cookbook</em>. Oreilly and Associate Series. O’Reilly Media, Incorporated.</p>
</div>
<div id="ref-schwabish2014economist">
<p>Schwabish, Jonathan A. 2014. “An Economist’s Guide to Visualizing Data.” <em>Journal of Economic Perspectives</em> 28 (1): 209–34.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="boucles.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="régressions-linéaires.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/3wen/R_course/edit/master/r_notes_de_cours.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsubsection",
"scroll_highlight": true
},
"toc_depth": 5,
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
